import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as h}from"./index.B2tizaEh.js";import{M as z,B as T,f as b,L as u,t as k,c as B,d as M}from"./static.CtRedSD-.js";import{H as $,L as P,d as A,g as R}from"./index.CpBG-F-y.js";import{I as g,b as V,a as H,c as W}from"./Input.DffHoTYS.js";import{S as E}from"./Select.ZVEuWD5g.js";import{f as U}from"./fetchRequest.Dmuu1wXS.js";import{T as q,B as J}from"./index.Dw8mBJ3b.js";import{I as G,a as K}from"./index.hKw4G66c.js";import"./internal.BEJtFsX8.js";function C({onClick:a,disabled:l=!1}){return e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(T,{onClick:a,size:"small",variant:"primary",disabled:l,children:"apply"})})}function O({label:a,icon:l,children:d}){return e.jsxs("div",{className:"dropdown ",children:[e.jsxs("div",{tabIndex:0,role:"button",className:"btn btn-ghost btn-md m-1",children:[l,a,e.jsx(W,{})]}),e.jsx("div",{tabIndex:0,className:"dropdown-content card card-compact bg-base-100 border border-neutral-500/20 rounded-lg z-[1] w-64 p-2 shadow-lg",children:e.jsx("div",{className:"card-body",children:d})})]})}function Q({traces:a,setTraces:l,loading:d,setLoading:p,setError:m,setSuccess:v,handleFileUpload:w,appliedProcesses:f,setAppliedProcesses:j}){const[i,N]=h.useState({"detrend-type":"simple","taper-type":"parzen","taper-side":"both","taper-length":20,"trim-left-side":0,"trim-right-side":0,"filter-min":0,"filter-max":0});let x=a.length!==0?a[0].ydata.length/a[0].stats.sampling_rate:0;async function D(){const t={fetchURL:b["TRIM-WAVEFORM"],text:`trim-${i["trim-left-side"]}-${i["trim-right-side"]}`,fetchBody:{data:a.map(s=>({trace_id:s.trace_id,values:s.ydata})),options:{sampling_rate:a[0].stats.sampling_rate,trim_start:i["trim-left-side"],trim_end:i["trim-right-side"]}},processId:R()},n=await fetch(t.fetchURL,{method:"POST",body:JSON.stringify(t.fetchBody),credentials:"include",headers:{"Content-Type":"application/json"}});if(!n.ok){const s=await n.json();throw m(s.error_message),new Error(`Error: ${n.status} - ${s.message||"Request failed"}`)}const r=await n.json();m([]),l(a.map(s=>{const o=r.find(_=>_.trace_id===s.trace_id);return o?{...s,ydata:o.values}:s})),j([...f,t]),N({...i,"trim-left-side":0,"trim-right-side":0})}async function S(){const t={fetchURL:b["TAPER-WAVEFORM"],text:`taper-${i["taper-type"]}-${i["taper-side"]}-${i["taper-length"]}`,fetchBody:{data:a.map(s=>({trace_id:s.trace_id,values:s.ydata})),options:{sampling_rate:a[0].stats.sampling_rate,taper_type:i["taper-type"],taper_side:i["taper-side"],taper_length:i["taper-length"]}},processId:R()},n=await fetch(t.fetchURL,{method:"POST",body:JSON.stringify(t.fetchBody),credentials:"include",headers:{"Content-Type":"application/json"}});if(!n.ok){const s=await n.json();throw m(s.error_message),new Error(`Error: ${n.status} - ${s.message||"Request failed"}`)}const r=await n.json();m([]),l(a.map(s=>{const o=r.find(_=>_.trace_id===s.trace_id);return o?{...s,ydata:o.values}:s})),j([...f,t])}async function F(){const t={fetchURL:b["DETREND-WAVEFORM"],text:`detrend-${i["detrend-type"]}`,fetchBody:{data:a.map(s=>({trace_id:s.trace_id,values:s.ydata})),options:{sampling_rate:a[0].stats.sampling_rate,detrend_type:i["detrend-type"]}},processId:R()},n=await fetch(t.fetchURL,{method:"POST",body:JSON.stringify(t.fetchBody),credentials:"include",headers:{"Content-Type":"application/json"}});if(!n.ok){const s=await n.json();throw m(s.error_message),new Error(`Error: ${n.status} - ${s.message||"Request failed"}`)}const r=await n.json();m([]),l(a.map(s=>{const o=r.find(_=>_.trace_id===s.trace_id);return o?{...s,ydata:o.values}:s})),j([...f,t])}function L(t,n){return t===null&&n===null?"no-filter":t===null&&n!==null?`lowpass-${n}Hz`:t!==null&&n==null?`highpass-${t}Hz`:`bandpass-${t}-${n}Hz`}async function I(){const t={fetchURL:b["FILTER-WAVEFORM"],text:L(i["filter-min"]?i["filter-min"]:null,i["filter-max"]?i["filter-max"]:null),fetchBody:{data:a.map(r=>({trace_id:r.trace_id,values:r.ydata})),options:{sampling_rate:a[0].stats.sampling_rate,freq_min:i["filter-min"]?i["filter-min"]:null,freq_max:i["filter-max"]?i["filter-max"]:null}},processId:R()},n=await U({endpoint:t.fetchURL,setError:m,setSuccess:v,setLoading:p,data:t.fetchBody,method:"POST"});l(a.map(r=>{const s=n.find(o=>o.trace_id===r.trace_id);return s?{...r,ydata:s.values}:r})),j([...f,t])}function c(t,n,r="text"){const s=r==="text"?n:Number(n),o={...i,[t]:s};N(o)}async function y(t,n,r){const s=await U({endpoint:b["DOWNLOAD-FILE"],setError:m,setSuccess:v,setLoading:p,method:"POST",data:{data:n,file_type:t},returnType:"blob"}),o=window.URL.createObjectURL(s);A(o,r+"."+t)}return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-row items-center justify-center",children:[e.jsxs("div",{className:"grow-0 border-r border-neutral-500/20",children:[e.jsxs(T,{onClick:w,loading:d,variant:"ghost",toolTipText:"Upload a seismic file",children:[e.jsx($,{}),"Upload file"]}),e.jsxs(T,{loading:d,variant:"ghost",onClick:()=>y("mseed",a,a[0].stats.record_name+"_download"),disabled:a.length===0,toolTipText:"Download the processed seismic file into MiniSEED file format",children:[e.jsx(q,{}),"Download To MSEED"]})]}),e.jsxs("div",{className:"grow",children:[e.jsx(O,{icon:e.jsx(J,{}),label:"Taper",children:e.jsxs("div",{className:"flex flex-col items-stretch gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(u,{htmlFor:"taper-type",label:"Type"}),e.jsx(E,{id:"taper-type",name:"taper-type",optionsList:k,value:i["taper-type"],size:"sm",onChange:t=>c("taper-type",t.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(u,{htmlFor:"taper-side",label:"Side"}),e.jsx(E,{id:"taper-side",name:"taper-side",optionsList:B,value:i["taper-side"],size:"sm",onChange:t=>c("taper-side",t.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(u,{htmlFor:"taper-length",label:"Length"}),e.jsx(g,{type:"number",id:"taper-length",name:"taper-length",min:0,max:100,step:.1,size:"sm",value:i["taper-length"],onChange:t=>c("taper-length",t.target.value,"number")})]}),e.jsx(C,{onClick:S,disabled:a.length===0})]})}),e.jsx(O,{icon:e.jsx(G,{}),label:"Trim",children:e.jsxs("div",{className:"flex flex-col items-stretch gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(u,{htmlFor:"trim-left-side",label:"Start time (sec)"}),e.jsx(g,{type:"number",id:"trim-left-side",name:"trim-left-side",min:0,max:x,step:.1,size:"sm",value:i["trim-left-side"],onChange:t=>c("trim-left-side",t.target.value,"number")}),e.jsx(g,{type:"range",id:"trim-left-side",name:"trim-left-side",min:0,max:x,step:.1,size:"xs",value:i["trim-left-side"],onChange:t=>c("trim-left-side",t.target.value,"number")})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(u,{htmlFor:"trim-right-side",label:"End time (sec)"}),e.jsx(g,{type:"number",id:"trim-right-side",name:"trim-right-side",min:0,max:x,step:.1,size:"sm",value:i["trim-right-side"],onChange:t=>c("trim-right-side",t.target.value,"number")}),e.jsx(g,{type:"range",id:"trim-right-side",name:"trim-right-side",min:0,max:x,step:.1,size:"xs",value:i["trim-right-side"],onChange:t=>c("trim-right-side",t.target.value,"number")})]}),e.jsx(C,{onClick:D,disabled:a.length===0})]})}),e.jsx(O,{icon:e.jsx(V,{}),label:"Detrend",children:e.jsxs("div",{className:"flex flex-col items-stretch gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(u,{htmlFor:"detrend-type",label:"Type"}),e.jsx(E,{id:"detrend-type",name:"detrend-type",size:"sm",optionsList:M,value:i["detrend-type"],onChange:t=>c("detrend-type",t.target.value)})]}),e.jsx(C,{onClick:F,disabled:a.length===0})]})}),e.jsx(O,{icon:e.jsx(K,{}),label:"Filter",children:e.jsxs("div",{className:"flex flex-col items-stretch gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(u,{htmlFor:"filter-min",label:"Min frequency"}),e.jsx(g,{type:"number",id:"filter-min",name:"filter-min",min:0,max:x,step:.1,size:"sm",value:i["filter-min"],onChange:t=>c("filter-min",t.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(u,{htmlFor:"freq-max",label:"Max frequency"}),e.jsx(g,{type:"number",id:"freq-max",name:"freq-max",min:0,max:x,step:.1,size:"sm",value:i["filter-max"],onChange:t=>c("filter-max",t.target.value)})]}),e.jsx(C,{onClick:I,disabled:a.length===0})]})})]})]})})}function X({traces:a,fourierData:l}){return e.jsx(e.Fragment,{children:a.map((d,p)=>e.jsx("div",{className:"h-1/3",children:e.jsx(P,{xData:a.length!==0?[d.xdata]:[],yData:a.length!==0?[d.ydata]:[],graphTitle:"",showLegend:!1})},d.trace_id))})}function Y({appliedProcesses:a,handleRemoveProcesses:l}){return e.jsx("div",{children:a.length!==0&&e.jsx("div",{children:e.jsxs("div",{className:"flex flex-row items-center flex-wrap gap-2 my-6",children:[e.jsx("p",{children:"Filters applied:"}),a.map((d,p)=>e.jsxs("span",{className:"badge badge-info",children:[p+1,". ",d.text]},d.processId)),e.jsx("span",{className:"ms-5",children:e.jsxs(T,{variant:"error",size:"extra-small",onClick:l,toolTipText:"Remove all applied filters",children:["remove all",e.jsx(H,{})]})})]})})})}function oe(){const[a,l]=h.useState([]),[d,p]=h.useState(null),[m,v]=h.useState(!1),[w,f]=h.useState([]),[j,i]=h.useState([]),[N,x]=h.useState([]),D=h.useRef(),[S,F]=h.useState([]);function L(){f(N),F([])}async function I(y){y.preventDefault();const t=new FormData;t.append("file",y.target.files[0]);const n=await U({endpoint:b["UPLOAD-SEISMIC-FILE"],setError:l,setSuccess:p,setLoading:v,method:"POST",data:t,successMessage:"The file has been succesfully uploaded!"});f(n),x(n)}function c(y){y.preventDefault(),D.current.click()}return e.jsxs("div",{children:[a.length!==0&&e.jsx(z,{setError:l,setSuccess:p,type:"error",text:a}),d&&e.jsx(z,{setError:l,setSuccess:p,type:"success",text:d}),e.jsx("input",{ref:D,name:"file",type:"file",onChange:I,hidden:!0}),e.jsxs("div",{className:"h-screen min-h-96",children:[e.jsx("div",{className:"border border-neutral-500/20 rounded-t-lg bg-base-100 p-1",children:e.jsx(Q,{traces:w,setTraces:f,loading:m,setLoading:v,setError:l,setSuccess:p,handleFileUpload:c,appliedProcesses:S,setAppliedProcesses:F})}),e.jsx("div",{className:"border border-neutral-500/20 h-2/3 overflow-y-scroll p-4 relative",children:w.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 absolute top-1/2 start-1/2 -translate-x-1/2 -translate-y-1/2",children:[e.jsx("h1",{className:"font-semibold text-3xl",children:"Upload a seismic file"}),e.jsx("p",{className:"text-lg",children:"Start by uploading a seismic file to interact with the tool"}),e.jsxs(T,{onClick:c,loading:m,toolTipText:"Upload a seismic file",children:[e.jsx($,{}),"Upload file"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{appliedProcesses:S,handleRemoveProcesses:L}),e.jsx(X,{traces:w,fourierData:j})]})})]})]})}export{oe as default};
