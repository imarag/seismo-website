import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as h}from"./index.B2tizaEh.js";import{M,B as y,L as w,T as O}from"./Button.EkLJJuSE.js";import{S as _,H as z,d as k,g as C,L as A}from"./index.CCAT2SBi.js";import{I as F,b as q,c as $,a as V}from"./index.BnPQjDp5.js";import{S as H}from"./Spinner.D8BFhGps.js";import{S as N}from"./Select.c42PT_5A.js";import{a as f,S as E,t as W,d as G,e as Q,g as Y,h as J,B as K,b as g}from"./index.iXrz_Df4.js";import{T as X}from"./index.BOP_Xtax.js";import{I as Z,a as ee}from"./index.D--nIKpA.js";import"./internal.BEJtFsX8.js";function T({onClick:s,loading:i,disabled:r=!1}){return e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(y,{onClick:s,loading:i,size:"small",style:"primary",disabled:r,children:"apply"})})}function R({label:s,icon:i,children:r}){return e.jsxs("div",{className:"dropdown",children:[e.jsxs("div",{tabIndex:0,role:"button",className:"btn btn-ghost btn-md",children:[i,e.jsx("span",{className:"text-xs",children:s}),e.jsx($,{})]}),e.jsx("div",{tabIndex:0,className:"dropdown-content card card-compact bg-base-100 border border-neutral-500/20 rounded-lg w-64 p-2 shadow-lg",children:e.jsx("div",{className:"card-body",children:r})})]})}function te({traces:s,setTraces:i,loading:r,setLoading:l,handleFileUpload:u,appliedProcesses:c,setAppliedProcesses:m,setShowMessage:p}){const[n,j]=h.useState({"detrend-type":"simple","taper-type":"parzen","taper-side":"both","taper-length":20,"trim-start":0,"trim-end":0,"freq-min":0,"freq-max":0});let b=s.length!==0?s[0].ydata.length/s[0].stats.sampling_rate:0;async function L(){const t={fetchURL:g["TRIM-WAVEFORM"],text:`trim-${n["trim-start"]}-${n["trim-end"]}`,fetchBody:{traces:s,options:{trim_start:n["trim-start"],trim_end:n["trim-end"]}},processId:C()},{resData:a,error:d}=await f({url:t.fetchURL,method:"post",requestData:t.fetchBody,setShowMessage:p,setLoading:l,errorMessage:"Cannot trim the waveforms. Please try again later."});d||(i(a),m([...c,t]),j({...n,"trim-start":0,"trim-end":0}))}async function I(){const t={fetchURL:g["TAPER-WAVEFORM"],text:`taper-${n["taper-type"]}-${n["taper-side"]}-${n["taper-length"]}`,fetchBody:{traces:s,options:{sampling_rate:s[0].stats.sampling_rate,taper_type:n["taper-type"],taper_side:n["taper-side"],taper_length:n["taper-length"]}},processId:C()},{resData:a,error:d}=await f({url:t.fetchURL,method:"post",requestData:t.fetchBody,setShowMessage:p,setLoading:l,errorMessage:"Cannot taper the waveforms. Please try again later."});d||(i(a),m([...c,t]))}async function v(){const t={fetchURL:g["DETREND-WAVEFORM"],text:`detrend-${n["detrend-type"]}`,fetchBody:{traces:s,options:{detrend_type:n["detrend-type"]}},processId:C()},{resData:a,error:d}=await f({url:t.fetchURL,method:"post",requestData:t.fetchBody,setShowMessage:p,setLoading:l,errorMessage:"Cannot detrend the waveform. Please try again later."});d||(i(a),m([...c,t]))}function x(t,a){return t===null&&a===null?"no-filter":t===null&&a!==null?`lowpass-${a}Hz`:t!==null&&a==null?`highpass-${t}Hz`:`bandpass-${t}-${a}Hz`}async function D(){const t={fetchURL:g["FILTER-WAVEFORM"],text:x(n["freq-min"]?n["freq-min"]:null,n["freq-max"]?n["freq-max"]:null),fetchBody:{traces:s,options:{freq_min:n["freq-min"]?n["freq-min"]:null,freq_max:n["freq-max"]?n["freq-max"]:null}},processId:C()},{resData:a,error:d}=await f({url:t.fetchURL,method:"post",requestData:t.fetchBody,setShowMessage:p,setLoading:l,errorMessage:"Cannot filter the waveforms. Please try again later."});d||(i(a),m([...c,t]))}function o(t,a,d="text"){const P=d==="text"?a:Number(a),U={...n,[t]:P};j(U)}async function S(t,a,d){const{resData:P,error:U}=await f({url:g["DOWNLOAD-FILE"],method:"post",requestData:{data:a,file_type:t},setShowMessage:p,setLoading:l,errorMessage:"Cannot download the data. Please try again later.",responseType:"blob"});if(U)return;const B=window.URL.createObjectURL(P);k(B,d+"."+t)}return e.jsxs("div",{className:"flex flex-row items-center justify-center border border-neutral-500/20 rounded-t-lg bg-base-100 p-3",children:[e.jsxs("div",{className:"grow-0 shrink-0 border-r border-neutral-500/20",children:[e.jsxs(y,{onClick:u,style:"ghost",size:"small",disabled:r,toolTipText:"Upload a seismic file (one of the supported formats in Python Obspy's read function)",children:[e.jsx(E,{IconComponent:z}),"Upload file"]}),e.jsxs(y,{onClick:()=>S("mseed",s,s[0].stats.record_name+"_download"),style:"ghost",size:"small",disabled:s.length===0||r,toolTipText:"Download the processed seismic file into MiniSEED file format",children:[e.jsx(X,{}),"Download To MSEED"]})]}),e.jsxs("div",{className:"grow flex flex-row items-center",children:[e.jsx(R,{icon:e.jsx(G,{}),label:"Taper",children:e.jsxs("div",{className:"flex flex-col items-stretch gap-2",children:[W.map(t=>e.jsxs("div",{children:[e.jsx(w,{htmlFor:t.id,children:t.label}),t.type==="select"?e.jsx(N,{...t,optionsList:t.optionsList,size:"small",value:n[t.id],onChange:a=>o(t.id,a.target.value),disabled:s.length===0}):e.jsx(F,{...t,size:"small",value:n[t.id],onChange:a=>o(t.id,a.target.value),disabled:s.length===0})]},t.id)),e.jsx(T,{onClick:I,loading:r,disabled:s.length===0})]})}),e.jsx(R,{icon:e.jsx(Z,{}),label:"Trim",children:e.jsxs("div",{className:"flex flex-col items-stretch gap-2",children:[Q.map(t=>e.jsxs("div",{children:[e.jsx(w,{htmlFor:t.id,children:t.label}),t.type==="select"?e.jsx(N,{...t,optionsList:t.optionsList,size:"small",value:n[t.name],onChange:a=>o(t.name,a.target.value),disabled:s.length===0}):e.jsx(F,{...t,size:"small",value:n[t.name],max:b,onChange:a=>o(t.name,a.target.value,"number"),disabled:s.length===0})]},t.id)),e.jsx(T,{onClick:L,loading:r,disabled:s.length===0})]})}),e.jsx(R,{icon:e.jsx(q,{}),label:"Detrend",children:e.jsxs("div",{className:"flex flex-col items-stretch gap-2",children:[Y.map(t=>e.jsxs("div",{children:[e.jsx(w,{htmlFor:t.id,children:t.label}),t.type==="select"?e.jsx(N,{...t,optionsList:t.optionsList,size:"small",value:n[t.id],onChange:a=>o(t.id,a.target.value),disabled:s.length===0}):e.jsx(F,{...t,size:"small",value:n[t.id],onChange:a=>o(t.id,a.target.value),disabled:s.length===0})]},t.id)),e.jsx(T,{onClick:v,loading:r,disabled:s.length===0})]})}),e.jsx(R,{icon:e.jsx(ee,{}),label:"Filter",children:e.jsxs("div",{className:"flex flex-col items-stretch gap-2",children:[J.map(t=>e.jsxs("div",{children:[e.jsx(w,{htmlFor:t.id,children:t.label}),t.type==="select"?e.jsx(N,{...t,optionsList:t.optionsList,size:"small",value:n[t.id],onChange:a=>o(t.id,a.target.value),disabled:s.length===0}):e.jsx(F,{...t,size:"small",value:n[t.id],onChange:a=>o(t.id,a.target.value),disabled:s.length===0})]},t.id)),e.jsx(T,{onClick:D,loading:r,disabled:s.length===0})]})}),e.jsx(O,{className:"ms-auto",toolTipText:"Upload a seismic file and apply one of the pre-defined processing options. Feel free to download the processed traces.",toolTipPosition:"top-left",children:e.jsx(E,{IconComponent:K})})]})]})}function se({traces:s,fourierData:i}){return e.jsx(e.Fragment,{children:s.map((r,l)=>e.jsx("div",{className:"h-1/3",children:e.jsx(A,{xData:s.length!==0?[r.xdata]:[],yData:s.length!==0?[r.ydata]:[],graphTitle:"",showLegend:!1})},r.trace_id))})}function ae({appliedProcesses:s,handleRemoveProcesses:i}){return e.jsx("div",{children:s.length!==0&&e.jsx("div",{children:e.jsxs("div",{className:"flex flex-row items-center flex-wrap gap-2 my-6",children:[e.jsx("p",{children:"Filters applied:"}),s.map((r,l)=>e.jsxs("span",{className:"badge badge-sm badge-info",children:[l+1,". ",r.text]},r.processId)),e.jsx("span",{className:"ms-5",children:e.jsxs(y,{style:"error",size:"extra-small",onClick:i,toolTipText:"Remove all applied filters",children:["remove all",e.jsx(V,{})]})})]})})})}function ne({loading:s,handleFileUpload:i}){return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 absolute top-1/2 start-1/2 -translate-x-1/2 -translate-y-1/2",children:[e.jsx("h1",{className:"font-semibold text-3xl text-center",children:"Upload a seismic file"}),e.jsx("p",{className:"text-base text-center",children:"Start by uploading a seismic file to interact with the tool"}),e.jsxs(y,{onClick:i,loading:s,disabled:s,toolTipText:"Upload a seismic file (one of the supported formats in Python Obspy's read function)",children:[e.jsx(E,{IconComponent:z}),"Upload file"]})]})}function re({loading:s,handleFileUpload:i,traces:r,backupTraces:l,appliedProcesses:u,handleRemoveProcesses:c}){return e.jsx("div",{className:"border border-neutral-500/20 h-2/3 overflow-y-scroll p-4 relative",children:r.length===0?e.jsx(ne,{loading:s,handleFileUpload:i}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute start-1/2 -translate-x-1/2",children:s&&e.jsx(H,{})}),e.jsx(ae,{appliedProcesses:u,handleRemoveProcesses:c}),e.jsx(se,{traces:r,backupTraces:l})]})})}function ge(){const[s,i]=h.useState({message:"",type:""}),[r,l]=h.useState(!1),[u,c]=h.useState([]),[m,p]=h.useState([]),n=h.useRef(),[j,b]=h.useState([]);function L(){c(m),b([])}async function I(x){x.preventDefault();const D=new FormData;D.append("file",x.target.files[0]);const{resData:o,error:S}=await f({url:g["UPLOAD-SEISMIC-FILE"],method:"post",requestData:D,setShowMessage:i,setLoading:l,successMessage:"Your file has been uploaded!",errorMessage:"Cannot upload the file. Please try again later."});S||(c(o),p(o),b([]))}function v(x){x.preventDefault(),n.current.click()}return e.jsxs(e.Fragment,{children:[s.message&&e.jsx(M,{message:s.message,type:s.type,onClose:()=>i({type:"",message:""})}),e.jsx("input",{ref:n,name:"file",type:"file",onChange:I,hidden:!0}),e.jsx("div",{className:"md:hidden",children:e.jsx(_,{})}),e.jsxs("div",{className:"hidden md:block h-screen min-h-96",children:[e.jsx(te,{traces:u,setTraces:c,loading:r,setLoading:l,handleFileUpload:v,appliedProcesses:j,setAppliedProcesses:b,setShowMessage:i}),e.jsx(re,{loading:r,handleFileUpload:v,traces:u,backupTraces:m,appliedProcesses:j,handleRemoveProcesses:L})]})]})}export{ge as default};
