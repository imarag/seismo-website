import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as u}from"./index.B2tizaEh.js";import{S as M,d as S,H as L,L as k}from"./index.CCAT2SBi.js";import{M as U,B as c,T as D,L as A}from"./Button.EkLJJuSE.js";import{S as _}from"./Spinner.D8BFhGps.js";import{G as I,M as E,d as F,a as P,I as z,e as O}from"./index.BnPQjDp5.js";import{a as b,S as m,B as N,b as v,i as R,j as $}from"./index.iXrz_Df4.js";import{T as q}from"./index.BOP_Xtax.js";import"./internal.BEJtFsX8.js";function B(t){return I({attr:{viewBox:"0 0 32 32"},child:[{tag:"path",attr:{d:"M 16 3 C 12 3 8.4 4.7992187 6 7.6992188 L 6 4 L 4 4 L 4 12 L 12 12 L 12 10 L 6.8007812 10 C 8.8007812 7 12.1 5 16 5 C 22.1 5 27 9.9 27 16 C 27 22.1 22.1 27 16 27 C 9.9 27 5 22.1 5 16 L 3 16 C 3 23.2 8.8 29 16 29 C 23.2 29 29 23.2 29 16 C 29 8.8 23.2 3 16 3 z"},child:[]}]})(t)}function G(t){return I({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,82a46,46,0,1,0,46,46A46.06,46.06,0,0,0,128,82Zm0,80a34,34,0,1,1,34-34A34,34,0,0,1,128,162ZM214,130.84c.06-1.89.06-3.79,0-5.68L229.33,106a6,6,0,0,0,1.11-5.29A105.34,105.34,0,0,0,219.76,74.9a6,6,0,0,0-4.53-3l-24.45-2.71q-1.93-2.07-4-4l-2.72-24.46a6,6,0,0,0-3-4.53,105.65,105.65,0,0,0-25.77-10.66A6,6,0,0,0,150,26.68l-19.2,15.37c-1.89-.06-3.79-.06-5.68,0L106,26.67a6,6,0,0,0-5.29-1.11A105.34,105.34,0,0,0,74.9,36.24a6,6,0,0,0-3,4.53L69.23,65.22q-2.07,1.94-4,4L40.76,72a6,6,0,0,0-4.53,3,105.65,105.65,0,0,0-10.66,25.77A6,6,0,0,0,26.68,106l15.37,19.2c-.06,1.89-.06,3.79,0,5.68L26.67,150.05a6,6,0,0,0-1.11,5.29A105.34,105.34,0,0,0,36.24,181.1a6,6,0,0,0,4.53,3l24.45,2.71q1.94,2.07,4,4L72,215.24a6,6,0,0,0,3,4.53,105.65,105.65,0,0,0,25.77,10.66,6,6,0,0,0,5.29-1.11L125.16,214c1.89.06,3.79.06,5.68,0l19.21,15.38a6,6,0,0,0,3.75,1.31,6.2,6.2,0,0,0,1.54-.2,105.34,105.34,0,0,0,25.76-10.68,6,6,0,0,0,3-4.53l2.71-24.45q2.07-1.93,4-4l24.46-2.72a6,6,0,0,0,4.53-3,105.49,105.49,0,0,0,10.66-25.77,6,6,0,0,0-1.11-5.29Zm-3.1,41.63-23.64,2.63a6,6,0,0,0-3.82,2,75.14,75.14,0,0,1-6.31,6.31,6,6,0,0,0-2,3.82l-2.63,23.63A94.28,94.28,0,0,1,155.14,218l-18.57-14.86a6,6,0,0,0-3.75-1.31h-.36a78.07,78.07,0,0,1-8.92,0,6,6,0,0,0-4.11,1.3L100.87,218a94.13,94.13,0,0,1-17.34-7.17L80.9,187.21a6,6,0,0,0-2-3.82,75.14,75.14,0,0,1-6.31-6.31,6,6,0,0,0-3.82-2l-23.63-2.63A94.28,94.28,0,0,1,38,155.14l14.86-18.57a6,6,0,0,0,1.3-4.11,78.07,78.07,0,0,1,0-8.92,6,6,0,0,0-1.3-4.11L38,100.87a94.13,94.13,0,0,1,7.17-17.34L68.79,80.9a6,6,0,0,0,3.82-2,75.14,75.14,0,0,1,6.31-6.31,6,6,0,0,0,2-3.82l2.63-23.63A94.28,94.28,0,0,1,100.86,38l18.57,14.86a6,6,0,0,0,4.11,1.3,78.07,78.07,0,0,1,8.92,0,6,6,0,0,0,4.11-1.3L155.13,38a94.13,94.13,0,0,1,17.34,7.17l2.63,23.64a6,6,0,0,0,2,3.82,75.14,75.14,0,0,1,6.31,6.31,6,6,0,0,0,3.82,2l23.63,2.63A94.28,94.28,0,0,1,218,100.86l-14.86,18.57a6,6,0,0,0-1.3,4.11,78.07,78.07,0,0,1,0,8.92,6,6,0,0,0,1.3,4.11L218,155.13A94.13,94.13,0,0,1,210.85,172.47Z"},child:[]}]})(t)}function H({setShowMessage:t,setActivatedMenuIndex:n,loading:i,traces:s,setTraces:o,setLoading:h,traceId:d}){const[p,x]=u.useState(null),[f,a]=u.useState(s),r=f.find(l=>l.trace_id===d);async function j(l,y,C){let w=f.map((T,K)=>T.trace_id===l?{...T,stats:{...T.stats,[y]:C}}:T);a(w)}async function g(){const{resData:l,error:y}=await b({url:v["UPDATE-TRACE-HEADER"],method:"post",requestData:r.stats,setShowMessage:t,setLoading:h,successMessage:"Your header has been updated!",errorMessage:"Cannot update the header. Please try again later."});if(y)return;const C=s.map(w=>w.trace_id===d?{...w,stats:l}:w);o(C),a(C)}return e.jsx("form",{children:e.jsxs("div",{className:"flex flex-col pt-10 pb-6 px-4 items-stretch gap-1 absolute top-0 end-4 bg-base-200 border border-neutral-500/20 shadow rounded z-50 max-h-80",children:[e.jsx("div",{className:"absolute top-1 start-2",children:e.jsx(c,{style:"ghost",size:"small",onClick:()=>n(null),type:"button",children:e.jsx(P,{})})}),e.jsx("div",{className:"absolute top-2 end-4",children:e.jsx(D,{toolTipPosition:"bottom-left",toolTipText:"Use the menu to view header details of the selected trace. Click the pencil icon next to any editable field to make changes (fields marked with an asterisk * are read-only). Donâ€™t forget to click the 'Update header' button to save your changes.",children:e.jsx(m,{IconComponent:N})})}),e.jsx("div",{className:"flex flex-col items-stretch text-xs overflow-scroll",children:$.map(l=>e.jsxs("div",{children:[e.jsx(A,{htmlFor:l.id,className:"font-semibold",children:l.label}),e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[p===l.id?e.jsx(z,{...l,value:r.stats[l.id],onChange:y=>j(r.trace_id,l.id,y.target.value),size:"small",className:"w-40"}):e.jsx("p",{className:"w-40 font-light",children:r.stats[l.id]}),!l.readOnly&&(p===l.id?e.jsx(c,{style:"ghost",size:"extra-small",type:"button",onClick:()=>x(null),children:e.jsx(m,{IconComponent:B})}):e.jsx(c,{style:"ghost",size:"extra-small",type:"button",onClick:()=>x(l.id),children:e.jsx(m,{IconComponent:O})}))]}),e.jsx("hr",{className:"border-neutral-500/50 my-2 w-full"})]},l.id))}),e.jsx("p",{className:"text-xs text-center my-1",children:'Elements with "*" are readonly'}),e.jsx(c,{type:"button",style:"primary",loading:i,size:"extra-small",onClick:g,children:"Update header"})]})})}function Q({traces:t,handleFileUpload:n,loading:i,handleDownloadFile:s}){return e.jsxs("div",{className:"flex flex-row items-center justify-start gap-4 border border-neutral-500/20 rounded-t-lg bg-base-100 p-3",children:[e.jsxs(c,{onClick:n,disabled:i,style:"ghost",size:"extra-small",toolTipText:"Upload a seismic file (one of the supported formats in Python Obspy's read function)",children:[e.jsx(m,{IconComponent:L}),"Upload file"]}),e.jsxs(c,{onClick:()=>s("mseed",t,t[0].stats.record_name+"_download"),style:"ghost",size:"extra-small",loading:i,disabled:t.length===0,toolTipText:"Download the updated traces to MiniSEED file format",children:[e.jsx(E,{}),"Download to MSEED"]}),e.jsx(D,{className:"ms-auto",toolTipPosition:"top-left",toolTipText:"Import a seismic file to explore its contents. You can edit the header of each trace, download the data, or delete any trace as needed.",children:e.jsx(m,{IconComponent:N})})]})}function Z({trace:t,handleOptionsMenuButtonClick:n,handleDeleteTrace:i,handleDownloadFile:s,currentMenuIndex:o}){return e.jsxs("div",{className:"flex flex-row justify-end items-center gap-2",children:[e.jsx(c,{style:"ghost",size:"small",onClick:()=>n(o),toolTipText:"Open the trace header menu. Feel free to update the fields.",toolTipPosition:"bottom-left",children:e.jsx(m,{IconComponent:G})}),e.jsx(c,{style:"ghost",size:"small",onClick:()=>s("json",t.stats,t.stats.record_name+"_header"),toolTipText:"Download the header information of the current trace in a json format",toolTipPosition:"bottom-left",children:e.jsx(m,{IconComponent:q})}),e.jsx(c,{style:"ghost",size:"small",onClick:()=>s("json",{record_name:t.stats.record_name,component:t.stats.component,data:t.ydata},t.stats.record_name+"_data"),toolTipText:"Download the data values of the current trace in a json file format",toolTipPosition:"bottom-left",children:e.jsx(m,{IconComponent:R})}),e.jsx(c,{style:"ghost",size:"small",onClick:()=>i(t.trace_id),toolTipText:"Remove the current trace",toolTipPosition:"bottom-left",className:"text-error",children:e.jsx(m,{IconComponent:F})})]})}function Y({setShowMessage:t,setLoading:n,loading:i,traces:s,setTraces:o,handleDownloadFile:h}){const[d,p]=u.useState(null);function x(a){p(d===a?null:a)}function f(a){const r=s.filter(j=>j.trace_id!==a);o(r)}return e.jsx("div",{className:"flex-grow overflow-scroll",children:s.map((a,r)=>e.jsxs("div",{className:"h-40 relative",children:[e.jsx(Z,{trace:a,handleOptionsMenuButtonClick:x,handleDeleteTrace:f,handleDownloadFile:h,currentMenuIndex:r}),d===r&&e.jsx(H,{setShowMessage:t,setActivatedMenuIndex:p,loading:i,traces:s,setTraces:o,setLoading:n,traceId:a.trace_id}),e.jsx(k,{xData:[a.xdata],yData:[a.ydata],height:"220px",legendTitle:[`Component: ${a.stats.component}`],showGraphTitle:r===0,graphTitle:""})]},a.trace_id))})}function V({loading:t,handleFileUpload:n}){return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 absolute top-1/2 start-1/2 -translate-x-1/2 -translate-y-1/2",children:[e.jsx("h1",{className:"font-semibold text-3xl text-center",children:"Upload a seismic file"}),e.jsx("p",{className:"text-base text-center",children:"Start by uploading a seismic file to interact with the tool"}),e.jsxs(c,{onClick:n,loading:t,disabled:t,toolTipText:"Upload a seismic file (one of the supported formats in Python Obspy's read function)",children:[e.jsx(m,{IconComponent:L}),"Upload file"]})]})}function W({traces:t}){const[n,i]=u.useState(!1);return e.jsxs("div",{className:"my-4",children:[e.jsxs(c,{style:"primary",outline:!0,size:"extra-small",onClick:()=>i(s=>!s),children:[n?"Hide":"View"," traces info"]}),n&&e.jsxs("div",{className:"text-sm text-base-content/50 space-y-2 my-2 flex-grow-0 flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold",children:"Stream summary:"}),e.jsx("ul",{children:e.jsxs("li",{children:["Total traces: ",t.length]})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold",children:"Traces:"}),e.jsx("ul",{className:"overflow-auto w-full whitespace-nowrap",children:t.map((s,o)=>e.jsx("li",{className:"px-2",children:[`${o+1}. `,`component: ${s.stats.component}`,`station: ${s.stats.station}`,`start date: ${s.stats.start_date}`,`npts: ${s.stats.npts}`,`sampling rate: ${s.stats.sampling_rate}`].join(" | ")},o))})]})]})]})}function J({loading:t,setLoading:n,setShowMessage:i,handleFileUpload:s,traces:o,handleDownloadFile:h,setTraces:d}){return e.jsx("div",{className:"border border-neutral-500/20 h-2/3 p-4 flex flex-col relative",children:o.length===0?e.jsx(V,{loading:t,handleFileUpload:s}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute start-1/2 -translate-x-1/2",children:t&&e.jsx(_,{})}),e.jsx(W,{traces:o}),e.jsx(Y,{setShowMessage:i,setLoading:n,loading:t,traces:o,setTraces:d,handleDownloadFile:h})]})})}function re(){const[t,n]=u.useState({message:"",type:""}),[i,s]=u.useState(!1),[o,h]=u.useState([]),d=u.useRef();async function p(a){a.preventDefault();const r=new FormData;r.append("file",a.target.files[0]);const{resData:j,error:g}=await b({url:v["UPLOAD-SEISMIC-FILE"],method:"post",requestData:r,setShowMessage:n,setLoading:s,successMessage:"Your file has been uploaded!",errorMessage:"Cannot upload the file. Please try again later."});g||h(j)}function x(a){a.preventDefault(),d.current.click()}async function f(a,r,j){const{resData:g,error:l}=await b({url:v["DOWNLOAD-FILE"],method:"post",requestData:{data:r,file_type:a},setShowMessage:n,setLoading:s,errorMessage:"Cannot download the file. Please try again later.",responseType:"blob"});if(l)return;const y=window.URL.createObjectURL(g);S(y,j+"."+a)}return e.jsxs("div",{className:"space-y-8",children:[t.message&&e.jsx(U,{message:t.message,type:t.type,onClose:()=>n({type:"",message:""})}),e.jsx("input",{ref:d,name:"file",type:"file",onChange:p,hidden:!0}),e.jsx("div",{className:"md:hidden",children:e.jsx(M,{})}),e.jsxs("div",{className:"hidden md:block h-screen min-h-96",children:[e.jsx(Q,{traces:o,handleFileUpload:x,loading:i,handleDownloadFile:f}),e.jsx(J,{loading:i,setLoading:s,setShowMessage:n,handleFileUpload:x,traces:o,handleDownloadFile:f,setTraces:h})]})]})}export{re as default};
