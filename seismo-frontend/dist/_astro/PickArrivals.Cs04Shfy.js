import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as f}from"./index.B2tizaEh.js";import{S as A}from"./Spinner.D8BFhGps.js";import{M as _,B as y,f as D,a as T,L as E,b as O}from"./static.CtRedSD-.js";import{M as z,I as M,a as k}from"./Input.DffHoTYS.js";import{S as G}from"./Select.ZVEuWD5g.js";import{H as L,L as B,d as V}from"./index.CpBG-F-y.js";import{f as C}from"./fetchRequest.Dmuu1wXS.js";import"./internal.BEJtFsX8.js";function $({traces:t,selectedWave:a,setSelectedWave:s,handleDeleteWave:r,formattedArrivals:l}){return e.jsxs("div",{className:"flex flex-row items-center gap-4",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(E,{htmlFor:"p-wave-radio",label:"P",className:"text-lg"}),e.jsx(M,{type:"radio",id:"p-wave-radio",name:"ps-wave-radio",value:"P",checked:a==="P",onChange:()=>s("P"),disabled:t.length===0||l.P!==null,className:"radio-sm"})]}),e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(E,{htmlFor:"s-wave-radio",label:"S",className:"text-lg"}),e.jsx(M,{type:"radio",id:"s-wave-radio",name:"ps-wave-radio",value:"S",checked:a==="S",onChange:()=>s("S"),disabled:t.length===0||l.S!==null,className:"radio-sm"})]}),l.P!==null&&e.jsxs(y,{onClick:c=>r("P"),variant:"error",size:"extra-small",outline:!0,toolTipText:"Delete the selected P wave arrival",children:["P",e.jsx(k,{})]}),l.S!==null&&e.jsxs(y,{onClick:c=>r("S"),variant:"error",size:"extra-small",outline:!0,toolTipText:"Delete the selected S wave arrival",children:["S",e.jsx(k,{})]})]})}function H({traces:t,selectedFilter:a,handleDropdownFilterChange:s}){return e.jsx(G,{id:"filters-dropdown",name:"filters-dropdown",value:a,onChange:s,disabled:t.length===0,optionsList:O,className:"select-sm"})}function K({traces:t,manualFilter:a,setManualFilter:s,handleEnterKey:r}){return e.jsxs("div",{className:"flex justify-end align-center gap-3 mt-4",children:[e.jsx(M,{type:"number",id:"freq_min",name:"freq_min",value:a.freqMin,onKeyDown:r,onChange:l=>s({...a,freqMin:l.target.value}),placeholder:"e.g. 0.1",disabled:t.length===0,className:"input-sm w-40"}),e.jsx(M,{type:"number",id:"freq_max",name:"freq_max",value:a.freqMax,onKeyDown:r,onChange:l=>s({...a,freqMax:l.target.value}),placeholder:"e.g. 3",disabled:t.length===0,className:"input-sm w-40"})]})}function J({traces:t,setTraces:a,handleFilterChange:s,loading:r,setLoading:l,setError:c,setSuccess:p,handleFileUpload:g,arrivals:u,setArrivals:n,selectedWave:m,setSelectedWave:x,backupTraces:j}){const[b,P]=f.useState("initial");let d={P:null,S:null};u.forEach(i=>d[i.wave]=i.arrival),t.length!==0&&t[0].ydata.length/t[0].stats.sampling_rate;async function q(){let i=d.P,h=d.S,o=(i&&`Parr=${i}&`)+(h&&`Sarr=${h}`);const v=await C({endpoint:D["SAVE-ARRIVALS"]+"?"+o,setError:c,setSuccess:p,setLoading:l,method:"GET",returnType:"blob"}),w=window.URL.createObjectURL(v);V(w,"arrivals.txt")}function F(i){P(i.target.value);const h=i.target.value;if(h==="initial")a(j);else{const o=h.split("-");s(o[0],o[1])}}function N(i){x(i),n(u.filter(h=>h.wave!==i))}return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-row items-center justify-center",children:[e.jsxs("div",{className:"grow-0 border-r border-neutral-500/20",children:[e.jsxs(y,{onClick:g,variant:"ghost",size:"small",toolTipText:"Upload a seismic file",children:[e.jsx(L,{}),"Upload file"]}),e.jsxs(y,{variant:"ghost",size:"small",onClick:q,disabled:t.length===0||d.P===null&&d.S===null,toolTipText:"Download the selected P & S wave arrivals in a txt file",children:[e.jsx(z,{}),"Download arrivals"]})]}),e.jsxs("div",{className:"grow flex flex-row justify-around items-center",children:[e.jsx($,{traces:t,selectedWave:m,setSelectedWave:x,handleDeleteWave:N,formattedArrivals:d}),e.jsx(H,{traces:t,selectedFilter:b,handleDropdownFilterChange:F})]})]})})}function Q({traces:t,arrivals:a,selectedWave:s,setArrivals:r,setSelectedWave:l,backupTraces:c}){let p=a.map(n=>({x:c.length!==0?n.arrival-c[0].stats.duration/40:0,y:.8,xref:"x",yref:"paper",text:n.wave,showarrow:!1,font:{size:T.label.size}})),g=a.map(n=>({type:"line",x0:n.arrival,y0:0,x1:n.arrival,y1:1,line:{color:T.line.color,width:T.line.width,dash:T.line.style},xref:"x",yref:"paper"}));function u(n){const m=n.points[0];for(let x of a)if(x.wave===s&&x.arrival)return;if(m){const x=m.x;l(s==="P"?"S":"P"),r(j=>[...j,{wave:s,arrival:x}])}}return e.jsx(e.Fragment,{children:t.map((n,m)=>e.jsx("div",{className:"h-1/3",children:e.jsx(B,{xData:[n.xdata],yData:[n.ydata],height:"220px",legendTitle:[`Component: ${n.stats.component}`],showGraphTitle:m===0,graphTitle:"",shapes:g,annotations:p,onGraphClick:u})},n.trace_id))})}function ne(){const[t,a]=f.useState([]),[s,r]=f.useState(null),[l,c]=f.useState(!1),[p,g]=f.useState([]),[u,n]=f.useState([]),[m,x]=f.useState([]),j=f.useRef(),[b,P]=f.useState("P"),[d,q]=f.useState({freqMin:1,freqMax:3});async function F(o){o.preventDefault();const v=new FormData;v.append("file",o.target.files[0]);const w=await C({endpoint:D["UPLOAD-SEISMIC-FILE"],setError:a,setSuccess:r,setLoading:c,method:"POST",data:v,successMessage:"The file has been succesfully uploaded!"});g(w),n(w)}function N(o){o.preventDefault(),j.current.click()}async function i(o=null,v=null){const w={data:u.map(S=>({trace_id:S.trace_id,values:S.ydata})),options:{freq_min:o,freq_max:v,sampling_rate:u[0].stats.sampling_rate}},U=await C({endpoint:D["FILTER-WAVEFORM"],setError:a,setSuccess:r,setLoading:c,method:"POST",data:w});g(u.map(S=>{const R=U.find(I=>I.trace_id===S.trace_id);return{...S,ydata:R.values}}))}function h(o){o.key==="Enter"&&i(d.freqMin?d.freqMin:null,d.freqMax?d.freqMax:null)}return e.jsxs(e.Fragment,{children:[t.length!==0&&e.jsx(_,{setError:a,setSuccess:r,type:"error",text:t}),s&&e.jsx(_,{setError:a,setSuccess:r,type:"success",text:s}),e.jsx("input",{ref:j,name:"file",type:"file",onChange:F,hidden:!0}),e.jsxs("div",{className:"h-screen min-h-96",children:[e.jsx("div",{className:"border border-neutral-500/20 rounded-t-lg bg-base-100 p-3",children:e.jsx(J,{traces:p,setTraces:g,handleFilterChange:i,loading:l,setLoading:c,setError:a,setSuccess:r,handleFileUpload:N,arrivals:m,setArrivals:x,selectedWave:b,setSelectedWave:P,backupTraces:u})}),e.jsx("div",{className:"border border-neutral-500/20 h-2/3 overflow-y-scroll p-4 relative",children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute start-1/2 ",children:l&&e.jsx(A,{})}),p.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 absolute top-1/2 start-1/2 -translate-x-1/2 -translate-y-1/2",children:[e.jsx("h1",{className:"font-semibold text-3xl",children:"Upload a seismic file"}),e.jsx("p",{className:"text-lg",children:"Start by uploading a seismic file to interact with the tool"}),e.jsxs(y,{onClick:N,loading:l,toolTipText:"Upload a seismic file",children:[e.jsx(L,{}),"Upload file"]})]}):e.jsx(e.Fragment,{children:e.jsx(Q,{traces:p,arrivals:m,selectedWave:b,setArrivals:x,setSelectedWave:P,backupTraces:u})})]})}),p.length!==0&&e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(K,{traces:p,manualFilter:d,setManualFilter:q,handleEnterKey:h})})]})]})}export{ne as default};
