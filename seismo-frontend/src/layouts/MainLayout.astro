---
import "../styles/global.css";
import Head from "../components/root/Head.astro";
import Header from "../components/root/Header.astro";
import Footer from "../components/root/Footer.astro";
import ConsentBanner from "../components/root/ConsentBanner.astro";
import "@fontsource-variable/roboto";
const { pageTitle } = Astro.props;
---

<html lang="en" data-theme="forest" class="font-display text-lg font-light">
  <head>
    <Head pageTitle={pageTitle} />
  </head>
  <body>
    <Header />
    <main>
      <slot />
    </main>
    <Footer />
    <ConsentBanner />
  </body>
</html>

<script>
  const CONSENT_KEY = "ga_consent";

  function handleConsent(accepted) {
    localStorage.setItem(CONSENT_KEY, accepted ? "granted" : "denied");
    document.getElementById("cookie-consent-banner").style.display = "none";
    if (accepted) {
      loadGoogleAnalytics();
    }
  }

  function loadGoogleAnalytics() {
    const script = document.createElement("script");
    script.src = "https://www.googletagmanager.com/gtag/js?id=G-YNYD1NBR7E";
    script.async = true;
    document.head.appendChild(script);

    script.onload = function () {
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-YNYD1NBR7E");
    };
  }

  window.addEventListener("DOMContentLoaded", () => {
    const consent = localStorage.getItem(CONSENT_KEY);
    const banner = document.getElementById("cookie-consent-banner");
    const acceptBtn = document.getElementById("consent-accept");
    const declineBtn = document.getElementById("consent-decline");

    if (consent === "granted") {
      loadGoogleAnalytics();
    } else if (consent === null) {
      banner.style.display = "block";
    }

    acceptBtn?.addEventListener("click", () => handleConsent(true));
    declineBtn?.addEventListener("click", () => handleConsent(false));
  });
</script>
