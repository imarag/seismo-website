import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as f}from"./index.B2tizaEh.js";import{S as A}from"./Spinner.D8BFhGps.js";import{M as E,B as S,f as C,a as M,L as k,b as O}from"./static.CZ2xIqof.js";import{M as z,I as q,a as L}from"./index.DK8rA4Xx.js";import{S as G}from"./Select.C7vNqle-.js";import{H as T,L as B,d as V}from"./index.CinGAp6I.js";import{f as _}from"./fetchRequest.Dmuu1wXS.js";import"./internal.BEJtFsX8.js";function $({traces:a,selectedWave:t,setSelectedWave:s,handleDeleteWave:r,formattedArrivals:l}){return e.jsxs("div",{className:"flex flex-row items-center gap-4",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(k,{htmlFor:"p-wave-radio",className:"text-lg mx-2",children:"P"}),e.jsx(q,{type:"radio",id:"p-wave-radio",name:"ps-wave-radio",value:"P",checked:t==="P",onChange:()=>s("P"),disabled:a.length===0||l.P!==null,className:"radio-sm"})]}),e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(k,{htmlFor:"s-wave-radio",className:"text-lg mx-2",children:"S"}),e.jsx(q,{type:"radio",id:"s-wave-radio",name:"ps-wave-radio",value:"S",checked:t==="S",onChange:()=>s("S"),disabled:a.length===0||l.S!==null,className:"radio-sm"})]}),l.P!==null&&e.jsxs(S,{onClick:c=>r("P"),style:"error",size:"extra-small",outline:!0,tooltiptext:"Delete the selected P wave arrival",children:["P",e.jsx(L,{})]}),l.S!==null&&e.jsxs(S,{onClick:c=>r("S"),style:"error",size:"extra-small",outline:!0,tooltiptext:"Delete the selected S wave arrival",children:["S",e.jsx(L,{})]})]})}function H({traces:a,selectedFilter:t,handleDropdownFilterChange:s}){return e.jsx(G,{id:"filters-dropdown",name:"filters-dropdown",value:t,onChange:s,disabled:a.length===0,optionsList:O,className:"select-sm"})}function K({traces:a,manualFilter:t,setManualFilter:s,handleEnterKey:r}){return e.jsxs("div",{className:"flex justify-end align-center gap-3 mt-4",children:[e.jsx(q,{type:"number",id:"freq_min",name:"freq_min",value:t.freqMin,onKeyDown:r,onChange:l=>s({...t,freqMin:l.target.value}),placeholder:"e.g. 0.1",disabled:a.length===0,className:"input-sm w-40"}),e.jsx(q,{type:"number",id:"freq_max",name:"freq_max",value:t.freqMax,onKeyDown:r,onChange:l=>s({...t,freqMax:l.target.value}),placeholder:"e.g. 3",disabled:a.length===0,className:"input-sm w-40"})]})}function J({traces:a,setTraces:t,handleFilterChange:s,loading:r,setLoading:l,setError:c,setSuccess:m,handleFileUpload:g,arrivals:x,setArrivals:n,selectedWave:p,setSelectedWave:u,backupTraces:j}){const[b,P]=f.useState("initial");let d={P:null,S:null};x.forEach(i=>d[i.wave]=i.arrival),a.length!==0&&a[0].ydata.length/a[0].stats.sampling_rate;async function F(){let i=d.P,h=d.S,o=(i&&`Parr=${i}&`)+(h&&`Sarr=${h}`);const v=await _({endpoint:C["SAVE-ARRIVALS"]+"?"+o,setError:c,setSuccess:m,setLoading:l,method:"GET",returnType:"blob"}),w=window.URL.createObjectURL(v);V(w,"arrivals.txt")}function D(i){P(i.target.value);const h=i.target.value;if(h==="initial")t(j);else{const o=h.split("-");s(o[0],o[1])}}function N(i){u(i),n(x.filter(h=>h.wave!==i))}return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-row items-center justify-center",children:[e.jsxs("div",{className:"grow-0 border-r border-neutral-500/20",children:[e.jsxs(S,{onClick:g,style:"ghost",size:"small",tooltiptext:"Upload a seismic file",children:[e.jsx(T,{}),"Upload file"]}),e.jsxs(S,{style:"ghost",size:"small",onClick:F,disabled:a.length===0||d.P===null&&d.S===null,tooltiptext:"Download the selected P & S wave arrivals in a txt file",children:[e.jsx(z,{}),"Download arrivals"]})]}),e.jsxs("div",{className:"grow flex flex-row justify-around items-center",children:[e.jsx($,{traces:a,selectedWave:p,setSelectedWave:u,handleDeleteWave:N,formattedArrivals:d}),e.jsx(H,{traces:a,selectedFilter:b,handleDropdownFilterChange:D})]})]})})}function Q({traces:a,arrivals:t,selectedWave:s,setArrivals:r,setSelectedWave:l,backupTraces:c}){let m=t.map(n=>({x:c.length!==0?n.arrival-c[0].stats.duration/40:0,y:.8,xref:"x",yref:"paper",text:n.wave,showarrow:!1,font:{size:M.label.size}})),g=t.map(n=>({type:"line",x0:n.arrival,y0:0,x1:n.arrival,y1:1,line:{color:M.line.color,width:M.line.width,dash:M.line.style},xref:"x",yref:"paper"}));function x(n){const p=n.points[0];for(let u of t)if(u.wave===s&&u.arrival)return;if(p){const u=p.x;l(s==="P"?"S":"P"),r(j=>[...j,{wave:s,arrival:u}])}}return e.jsx(e.Fragment,{children:a.map((n,p)=>e.jsx("div",{className:"h-1/3",children:e.jsx(B,{xData:[n.xdata],yData:[n.ydata],height:"220px",legendTitle:[`Component: ${n.stats.component}`],showGraphTitle:p===0,graphTitle:"",shapes:g,annotations:m,onGraphClick:x})},n.trace_id))})}function ne(){const[a,t]=f.useState([]),[s,r]=f.useState(null),[l,c]=f.useState(!1),[m,g]=f.useState([]),[x,n]=f.useState([]),[p,u]=f.useState([]),j=f.useRef(),[b,P]=f.useState("P"),[d,F]=f.useState({freqMin:1,freqMax:3});async function D(o){o.preventDefault();const v=new FormData;v.append("file",o.target.files[0]);const w=await _({endpoint:C["UPLOAD-SEISMIC-FILE"],setError:t,setSuccess:r,setLoading:c,method:"POST",data:v,successMessage:"The file has been succesfully uploaded!"});g(w),n(w)}function N(o){o.preventDefault(),j.current.click()}async function i(o=null,v=null){const w={data:x.map(y=>({trace_id:y.trace_id,values:y.ydata})),options:{freq_min:o,freq_max:v,sampling_rate:x[0].stats.sampling_rate}},U=await _({endpoint:C["FILTER-WAVEFORM"],setError:t,setSuccess:r,setLoading:c,method:"POST",data:w});g(x.map(y=>{const R=U.find(I=>I.trace_id===y.trace_id);return{...y,ydata:R.values}}))}function h(o){o.key==="Enter"&&i(d.freqMin?d.freqMin:null,d.freqMax?d.freqMax:null)}return e.jsxs(e.Fragment,{children:[a.length!==0&&e.jsx(E,{setError:t,setSuccess:r,type:"error",text:a}),s&&e.jsx(E,{setError:t,setSuccess:r,type:"success",text:s}),e.jsx("input",{ref:j,name:"file",type:"file",onChange:D,hidden:!0}),e.jsxs("div",{className:"h-screen min-h-96",children:[e.jsx("div",{className:"border border-neutral-500/20 rounded-t-lg bg-base-100 p-3",children:e.jsx(J,{traces:m,setTraces:g,handleFilterChange:i,loading:l,setLoading:c,setError:t,setSuccess:r,handleFileUpload:N,arrivals:p,setArrivals:u,selectedWave:b,setSelectedWave:P,backupTraces:x})}),e.jsx("div",{className:"border border-neutral-500/20 h-2/3 overflow-y-scroll p-4 relative",children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute start-1/2 ",children:l&&e.jsx(A,{})}),m.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 absolute top-1/2 start-1/2 -translate-x-1/2 -translate-y-1/2",children:[e.jsx("h1",{className:"font-semibold text-3xl",children:"Upload a seismic file"}),e.jsx("p",{className:"text-lg",children:"Start by uploading a seismic file to interact with the tool"}),e.jsxs(S,{onClick:N,loading:l,tooltiptext:"Upload a seismic file",children:[e.jsx(T,{}),"Upload file"]})]}):e.jsx(e.Fragment,{children:e.jsx(Q,{traces:m,arrivals:p,selectedWave:b,setArrivals:u,setSelectedWave:P,backupTraces:x})})]})}),m.length!==0&&e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(K,{traces:m,manualFilter:d,setManualFilter:F,handleEnterKey:h})})]})]})}export{ne as default};
