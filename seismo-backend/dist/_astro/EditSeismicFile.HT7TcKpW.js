import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.B2tizaEh.js";import{S as _,H as N,d as A,L as k}from"./index.CKKKb5Xc.js";import{M as F,B as i,L as I}from"./Button.m1076Rmu.js";import{G as b,M as T,d as U,a as E,I as z,e as O}from"./index.DK8rA4Xx.js";import{a as D,f as M,g as R}from"./apiRequest.WIqHy6ry.js";import{T as q,a as B}from"./index.BTBJ6LNQ.js";import"./internal.BEJtFsX8.js";function G(s){return b({attr:{viewBox:"0 0 32 32"},child:[{tag:"path",attr:{d:"M 16 3 C 12 3 8.4 4.7992187 6 7.6992188 L 6 4 L 4 4 L 4 12 L 12 12 L 12 10 L 6.8007812 10 C 8.8007812 7 12.1 5 16 5 C 22.1 5 27 9.9 27 16 C 27 22.1 22.1 27 16 27 C 9.9 27 5 22.1 5 16 L 3 16 C 3 23.2 8.8 29 16 29 C 23.2 29 29 23.2 29 16 C 29 8.8 23.2 3 16 3 z"},child:[]}]})(s)}function P(s){return b({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,82a46,46,0,1,0,46,46A46.06,46.06,0,0,0,128,82Zm0,80a34,34,0,1,1,34-34A34,34,0,0,1,128,162ZM214,130.84c.06-1.89.06-3.79,0-5.68L229.33,106a6,6,0,0,0,1.11-5.29A105.34,105.34,0,0,0,219.76,74.9a6,6,0,0,0-4.53-3l-24.45-2.71q-1.93-2.07-4-4l-2.72-24.46a6,6,0,0,0-3-4.53,105.65,105.65,0,0,0-25.77-10.66A6,6,0,0,0,150,26.68l-19.2,15.37c-1.89-.06-3.79-.06-5.68,0L106,26.67a6,6,0,0,0-5.29-1.11A105.34,105.34,0,0,0,74.9,36.24a6,6,0,0,0-3,4.53L69.23,65.22q-2.07,1.94-4,4L40.76,72a6,6,0,0,0-4.53,3,105.65,105.65,0,0,0-10.66,25.77A6,6,0,0,0,26.68,106l15.37,19.2c-.06,1.89-.06,3.79,0,5.68L26.67,150.05a6,6,0,0,0-1.11,5.29A105.34,105.34,0,0,0,36.24,181.1a6,6,0,0,0,4.53,3l24.45,2.71q1.94,2.07,4,4L72,215.24a6,6,0,0,0,3,4.53,105.65,105.65,0,0,0,25.77,10.66,6,6,0,0,0,5.29-1.11L125.16,214c1.89.06,3.79.06,5.68,0l19.21,15.38a6,6,0,0,0,3.75,1.31,6.2,6.2,0,0,0,1.54-.2,105.34,105.34,0,0,0,25.76-10.68,6,6,0,0,0,3-4.53l2.71-24.45q2.07-1.93,4-4l24.46-2.72a6,6,0,0,0,4.53-3,105.49,105.49,0,0,0,10.66-25.77,6,6,0,0,0-1.11-5.29Zm-3.1,41.63-23.64,2.63a6,6,0,0,0-3.82,2,75.14,75.14,0,0,1-6.31,6.31,6,6,0,0,0-2,3.82l-2.63,23.63A94.28,94.28,0,0,1,155.14,218l-18.57-14.86a6,6,0,0,0-3.75-1.31h-.36a78.07,78.07,0,0,1-8.92,0,6,6,0,0,0-4.11,1.3L100.87,218a94.13,94.13,0,0,1-17.34-7.17L80.9,187.21a6,6,0,0,0-2-3.82,75.14,75.14,0,0,1-6.31-6.31,6,6,0,0,0-3.82-2l-23.63-2.63A94.28,94.28,0,0,1,38,155.14l14.86-18.57a6,6,0,0,0,1.3-4.11,78.07,78.07,0,0,1,0-8.92,6,6,0,0,0-1.3-4.11L38,100.87a94.13,94.13,0,0,1,7.17-17.34L68.79,80.9a6,6,0,0,0,3.82-2,75.14,75.14,0,0,1,6.31-6.31,6,6,0,0,0,2-3.82l2.63-23.63A94.28,94.28,0,0,1,100.86,38l18.57,14.86a6,6,0,0,0,4.11,1.3,78.07,78.07,0,0,1,8.92,0,6,6,0,0,0,4.11-1.3L155.13,38a94.13,94.13,0,0,1,17.34,7.17l2.63,23.64a6,6,0,0,0,2,3.82,75.14,75.14,0,0,1,6.31,6.31,6,6,0,0,0,3.82,2l23.63,2.63A94.28,94.28,0,0,1,218,100.86l-14.86,18.57a6,6,0,0,0-1.3,4.11,78.07,78.07,0,0,1,0,8.92,6,6,0,0,0,1.3,4.11L218,155.13A94.13,94.13,0,0,1,210.85,172.47Z"},child:[]}]})(s)}function H({setActivatedMenuIndex:s,traces:l,backupTraces:m,setTraces:d,setBackupTraces:u,setLoading:x,traceId:p}){const[o,f]=r.useState(null);async function g(t,c,L){let j=l.map((h,n)=>h.trace_id===t?{...h,stats:{...h.stats,[c]:L}}:h);d(j)}const a=l.find(t=>t.trace_id===p);return e.jsx("form",{onSubmit:t=>handleUpdateHeader(t),children:e.jsxs("div",{className:"flex flex-col p-4 items-stretch gap-1 absolute top-0 end-4 bg-base-200 border border-neutral-500/20 shadow rounded z-50",children:[e.jsx("div",{className:"absolute top-1 end-2",children:e.jsx(i,{style:"ghost",size:"small",onClick:()=>s(null),tooltiptext:"Close the menu.",type:"button",children:e.jsx(E,{})})}),e.jsx("div",{className:"flex flex-col items-stretch",children:R.map(t=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs",children:[e.jsx(I,{htmlFor:t.id,className:"font-semibold",children:t.label}),e.jsxs("div",{className:"flex flex-row justify-between items-center",children:[o===t.id?e.jsx(z,{...t,value:a.stats[t.id],onChange:c=>g(a.trace_id,t.id,c.target.value),size:"small",className:"w-40",...t}):e.jsx("p",{className:"w-40  font-light",children:a.stats[t.id]}),!t.readOnly&&(o===t.id?e.jsx(i,{style:"ghost",size:"extra-small",onClick:()=>f(null),children:e.jsx(G,{})}):e.jsx(i,{style:"ghost",size:"extra-small",onClick:()=>f(t.id),tooltiptext:`Update ${t.label}`,children:e.jsx(O,{})}))]})]},t.id),e.jsx("hr",{className:"border-neutral-500/50 my-2 w-full"})]}))}),e.jsx("p",{className:"text-xs text-center my-1",children:'Elements with "*" are readonly'})]})})}function Z({traces:s,handleFileUpload:l,handleDownloadFile:m}){return e.jsxs(e.Fragment,{children:[e.jsxs(i,{onClick:l,style:"ghost",size:"small",tooltiptext:"Upload a seismic file",children:[e.jsx(N,{}),"Upload file"]}),e.jsxs(i,{style:"ghost",size:"small",onClick:()=>m("mseed",s,s[0].stats.record_name+"_download"),disabled:s?s.length===0:!1,tooltiptext:"Download the updated traces to MiniSEED file format",children:["Download to MSEED",e.jsx(T,{})]})]})}function $({traces:s,backupTraces:l,setTraces:m,setBackupTraces:d,setLoading:u,handleDownloadFile:x}){const[p,o]=r.useState(null);function f(a){o(p===a?null:a)}function g(a){const t=s.filter(c=>c.trace_id!==a);m(t),d(t)}return e.jsx(e.Fragment,{children:s.map((a,t)=>e.jsxs("div",{className:"h-1/3 relative",children:[e.jsxs("div",{className:"flex flex-row justify-end items-center gap-2",children:[e.jsx(i,{style:"ghost",size:"small",onClick:()=>f(t),tooltiptext:"Open the trace header menu. Feel free to update the fields.",children:e.jsx(P,{})}),e.jsx(i,{style:"ghost",size:"small",onClick:()=>x("json",a.stats,a.stats.record_name+"_header"),tooltiptext:"Download the header information of updated traces in a json format",children:e.jsx(q,{})}),e.jsx(i,{style:"ghost",size:"small",onClick:()=>x("json",{record:a.stats.record_name,component:a.stats.component,data:a.ydata},a.stats.record_name+"_data"),tooltiptext:"Download the data values of the traces in a json file format",children:e.jsx(B,{})}),e.jsx(i,{style:"ghost",size:"small",onClick:()=>g(a.trace_id),tooltiptext:"Remove trace.",className:"text-error",children:e.jsx(U,{})})]}),p===t&&e.jsx(H,{setActivatedMenuIndex:o,traces:s,backupTraces:l,setTraces:m,setBackupTraces:d,setLoading:u,traceId:a.trace_id}),e.jsx(k,{xData:[a.xdata],yData:[a.ydata],height:"220px",legendTitle:[`Component: ${a.stats.component}`],showGraphTitle:t===0,graphTitle:""})]},a.trace_id))})}function te(){const[s,l]=r.useState({message:"",type:""}),[m,d]=r.useState(!1),[u,x]=r.useState([]),[p,o]=r.useState([]),[f,g]=r.useState(!1),[a,t]=r.useState({skip_rows:0,column_index:1,station:"",component:"",start_date:"1970-01-01",start_time:"00:00:00",sampling_rate:2}),c=r.useRef();async function L(n,C){n.preventDefault();const w=new FormData;w.append("file",n.target.files[0]);const{resData:y,error:v}=await D({url:M[C],method:"post",requestData:w,setShowMessage:l,setLoading:d,successMessage:"Your file has been uploaded!",errorMessage:"Cannot upload the file. Please try again later."});v||(x(y),o(y))}function j(n){n.preventDefault(),c.current.click()}async function h(n,C,w){const{resData:y,error:v}=await D({url:M["DOWNLOAD-FILE"],method:"post",requestData:{data:C,file_type:n},setShowMessage:l,setLoading:d,errorMessage:"Cannot download the file. Please try again later.",responseType:"blob"});if(v)return;const S=window.URL.createObjectURL(y);A(S,w+"."+n)}return e.jsxs(e.Fragment,{children:[s.message&&e.jsx(F,{message:s.message,type:s.type,autoDismiss:5e3,position:"bottom-right",onClose:()=>l({type:"",message:""})}),e.jsx("input",{ref:c,name:"file",type:"file",onChange:n=>L(n,"UPLOAD-SEISMIC-FILE"),hidden:!0}),e.jsx("div",{className:"md:hidden",children:e.jsx(_,{})}),e.jsxs("div",{className:"hidden md:block h-screen min-h-96",children:[e.jsx("div",{className:"border border-neutral-500/20 rounded-t-lg bg-base-200 p-3 flex flex-row items-center justify-start",children:e.jsx(Z,{traces:u,handleFileUpload:j,handleDownloadFile:h})}),e.jsx("div",{className:"border border-neutral-500/20 h-2/3 overflow-y-scroll p-4 relative",children:u.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 absolute top-1/2 start-1/2 -translate-x-1/2 -translate-y-1/2",children:[e.jsx("h1",{className:"text-4xl",children:"Upload a seismic file"}),e.jsx("p",{className:"text-lg",children:"Start by uploading a seismic file to interact with the tool"}),e.jsxs(i,{onClick:j,tooltiptext:"Upload a seismic file",loading:m,children:[e.jsx(N,{}),"Upload file"]})]}):e.jsx(e.Fragment,{children:e.jsx($,{traces:u,backupTraces:p,setTraces:x,setBackupTraces:o,setLoading:d,handleDownloadFile:h})})})]})]})}export{te as default};
