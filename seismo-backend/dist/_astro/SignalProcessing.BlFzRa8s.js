import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as h}from"./index.B2tizaEh.js";import{M as O,B as b,L as p}from"./Button.m1076Rmu.js";import{S as _,H as T,L as B,d as k,g as F}from"./index.CKKKb5Xc.js";import{I as x,b as A,a as P,c as $}from"./index.DK8rA4Xx.js";import{S as z}from"./Select.YcgN73Xe.js";import{a as g,t as q,d as V,e as H,f as j}from"./apiRequest.WIqHy6ry.js";import{T as W,B as G}from"./index.BTBJ6LNQ.js";import{I as Y,a as J}from"./index.BjSa8P0S.js";import"./internal.BEJtFsX8.js";function R({onClick:a,disabled:i=!1}){return e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(b,{onClick:a,size:"small",style:"primary",disabled:i,children:"apply"})})}function S({label:a,icon:i,children:n}){return e.jsxs("div",{className:"dropdown ",children:[e.jsxs("div",{tabIndex:0,role:"button",className:"btn btn-ghost btn-md m-1",children:[i,a,e.jsx($,{})]}),e.jsx("div",{tabIndex:0,className:"dropdown-content card card-compact bg-base-100 border border-neutral-500/20 rounded-lg z-[1] w-64 p-2 shadow-lg",children:e.jsx("div",{className:"card-body",children:n})})]})}function K({traces:a,setTraces:i,loading:n,setLoading:o,handleFileUpload:y,appliedProcesses:c,setAppliedProcesses:f,setShowMessage:u}){const[s,D]=h.useState({"detrend-type":"simple","taper-type":"parzen","taper-side":"both","taper-length":20,"trim-left-side":0,"trim-right-side":0,"filter-min":0,"filter-max":0});let m=a.length!==0?a[0].ydata.length/a[0].stats.sampling_rate:0;async function w(){const t={fetchURL:j["TRIM-WAVEFORM"],text:`trim-${s["trim-left-side"]}-${s["trim-right-side"]}`,fetchBody:{traces:a,options:{trim_start:s["trim-left-side"],trim_end:s["trim-right-side"]}},processId:F()},{resData:r,error:d}=await g({url:t.fetchURL,method:"post",requestData:t.fetchBody,setShowMessage:u,setLoading:o,errorMessage:"Cannot trim the waveforms. Please try again later."});d||(i(r),f([...c,t]),D({...s,"trim-left-side":0,"trim-right-side":0}))}async function v(){const t={fetchURL:j["TAPER-WAVEFORM"],text:`taper-${s["taper-type"]}-${s["taper-side"]}-${s["taper-length"]}`,fetchBody:{traces:a,options:{sampling_rate:a[0].stats.sampling_rate,taper_type:s["taper-type"],taper_side:s["taper-side"],taper_length:s["taper-length"]}},processId:F()},{resData:r,error:d}=await g({url:t.fetchURL,method:"post",requestData:t.fetchBody,setShowMessage:u,setLoading:o,errorMessage:"Cannot taper the waveforms. Please try again later."});d||(i(r),f([...c,t]))}async function I(){const t={fetchURL:j["DETREND-WAVEFORM"],text:`detrend-${s["detrend-type"]}`,fetchBody:{traces:a,options:{detrend_type:s["detrend-type"]}},processId:F()},{resData:r,error:d}=await g({url:t.fetchURL,method:"post",requestData:t.fetchBody,setShowMessage:u,setLoading:o,errorMessage:"Cannot detrend the waveform. Please try again later."});d||(i(r),f([...c,t]))}function E(t,r){return t===null&&r===null?"no-filter":t===null&&r!==null?`lowpass-${r}Hz`:t!==null&&r==null?`highpass-${t}Hz`:`bandpass-${t}-${r}Hz`}async function N(){const t={fetchURL:j["FILTER-WAVEFORM"],text:E(s["filter-min"]?s["filter-min"]:null,s["filter-max"]?s["filter-max"]:null),fetchBody:{traces:a,options:{freq_min:s["filter-min"]?s["filter-min"]:null,freq_max:s["filter-max"]?s["filter-max"]:null}},processId:F()},{resData:r,error:d}=await g({url:t.fetchURL,method:"post",requestData:t.fetchBody,setShowMessage:u,setLoading:o,errorMessage:"Cannot filter the waveforms. Please try again later."});d||(i(r),f([...c,t]))}function l(t,r,d="text"){const U=d==="text"?r:Number(r),L={...s,[t]:U};D(L)}async function C(t,r,d){const{resData:U,error:L}=await g({url:j["DOWNLOAD-FILE"],method:"post",requestData:{data:r,file_type:t},setShowMessage:u,setLoading:o,errorMessage:"Cannot download the data. Please try again later.",responseType:"blob"});if(L)return;const M=window.URL.createObjectURL(U);k(M,d+"."+t)}return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-row items-center justify-center",children:[e.jsxs("div",{className:"grow-0 border-r border-neutral-500/20",children:[e.jsxs(b,{onClick:y,loading:n,style:"ghost",tooltiptext:"Upload a seismic file",children:[e.jsx(T,{}),"Upload file"]}),e.jsxs(b,{loading:n,style:"ghost",onClick:()=>C("mseed",a,a[0].stats.record_name+"_download"),disabled:a.length===0,tooltiptext:"Download the processed seismic file into MiniSEED file format",children:[e.jsx(W,{}),"Download To MSEED"]})]}),e.jsxs("div",{className:"grow",children:[e.jsx(S,{icon:e.jsx(G,{}),label:"Taper",children:e.jsxs("div",{className:"flex flex-col items-stretch gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(p,{htmlFor:"taper-type",children:"Type"}),e.jsx(z,{id:"taper-type",name:"taper-type",optionslist:q,value:s["taper-type"],size:"sm",onChange:t=>l("taper-type",t.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(p,{htmlFor:"taper-side",children:"Side"}),e.jsx(z,{id:"taper-side",name:"taper-side",optionslist:V,value:s["taper-side"],size:"sm",onChange:t=>l("taper-side",t.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(p,{htmlFor:"taper-length",children:"Length"}),e.jsx(x,{type:"number",id:"taper-length",name:"taper-length",min:0,max:100,step:.1,size:"sm",value:s["taper-length"],onChange:t=>l("taper-length",t.target.value,"number")})]}),e.jsx(R,{onClick:v,disabled:a.length===0})]})}),e.jsx(S,{icon:e.jsx(Y,{}),label:"Trim",children:e.jsxs("div",{className:"flex flex-col items-stretch gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(p,{htmlFor:"trim-left-side",children:"Start time (sec)"}),e.jsx(x,{type:"number",id:"trim-left-side",name:"trim-left-side",min:0,max:m,step:.1,size:"sm",value:s["trim-left-side"],onChange:t=>l("trim-left-side",t.target.value,"number")}),e.jsx(x,{type:"range",id:"trim-left-side",name:"trim-left-side",min:0,max:m,step:.1,size:"xs",value:s["trim-left-side"],onChange:t=>l("trim-left-side",t.target.value,"number")})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(p,{htmlFor:"trim-right-side",children:"End time (sec)"}),e.jsx(x,{type:"number",id:"trim-right-side",name:"trim-right-side",min:0,max:m,step:.1,size:"sm",value:s["trim-right-side"],onChange:t=>l("trim-right-side",t.target.value,"number")}),e.jsx(x,{type:"range",id:"trim-right-side",name:"trim-right-side",min:0,max:m,step:.1,size:"xs",value:s["trim-right-side"],onChange:t=>l("trim-right-side",t.target.value,"number")})]}),e.jsx(R,{onClick:w,disabled:a.length===0})]})}),e.jsx(S,{icon:e.jsx(A,{}),label:"Detrend",children:e.jsxs("div",{className:"flex flex-col items-stretch gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(p,{htmlFor:"detrend-type",children:"Type"}),e.jsx(z,{id:"detrend-type",name:"detrend-type",size:"sm",optionslist:H,value:s["detrend-type"],onChange:t=>l("detrend-type",t.target.value)})]}),e.jsx(R,{onClick:I,disabled:a.length===0})]})}),e.jsx(S,{icon:e.jsx(J,{}),label:"Filter",children:e.jsxs("div",{className:"flex flex-col items-stretch gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(p,{htmlFor:"filter-min",children:"Min frequency"}),e.jsx(x,{type:"number",id:"filter-min",name:"filter-min",min:0,max:m,step:.1,size:"sm",value:s["filter-min"],onChange:t=>l("filter-min",t.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(p,{htmlFor:"freq-max",children:"Max frequency"}),e.jsx(x,{type:"number",id:"freq-max",name:"freq-max",min:0,max:m,step:.1,size:"sm",value:s["filter-max"],onChange:t=>l("filter-max",t.target.value)})]}),e.jsx(R,{onClick:N,disabled:a.length===0})]})})]})]})})}function Q({traces:a,fourierData:i}){return e.jsx(e.Fragment,{children:a.map((n,o)=>e.jsx("div",{className:"h-1/3",children:e.jsx(B,{xData:a.length!==0?[n.xdata]:[],yData:a.length!==0?[n.ydata]:[],graphTitle:"",showLegend:!1})},n.trace_id))})}function X({appliedProcesses:a,handleRemoveProcesses:i}){return e.jsx("div",{children:a.length!==0&&e.jsx("div",{children:e.jsxs("div",{className:"flex flex-row items-center flex-wrap gap-2 my-6",children:[e.jsx("p",{children:"Filters applied:"}),a.map((n,o)=>e.jsxs("span",{className:"badge badge-info",children:[o+1,". ",n.text]},n.processId)),e.jsx("span",{className:"ms-5",children:e.jsxs(b,{style:"error",size:"extra-small",onClick:i,tooltiptext:"Remove all applied filters",children:["remove all",e.jsx(P,{})]})})]})})})}function de(){const[a,i]=h.useState({message:"",type:""}),[n,o]=h.useState(!1),[y,c]=h.useState([]),[f,u]=h.useState([]),[s,D]=h.useState([]),m=h.useRef(),[w,v]=h.useState([]);function I(){c(s),v([])}async function E(l){l.preventDefault();const C=new FormData;C.append("file",l.target.files[0]);const{resData:t,error:r}=await g({url:j["UPLOAD-SEISMIC-FILE"],method:"post",requestData:C,setShowMessage:i,setLoading:o,successMessage:"Your file has been uploaded!",errorMessage:"Cannot upload the file. Please try again later."});r||(c(t),D(t),v([]))}function N(l){l.preventDefault(),m.current.click()}return e.jsxs("div",{children:[a.message&&e.jsx(O,{message:a.message,type:a.type,autoDismiss:5e3,position:"bottom-right",onClose:()=>i({type:"",message:""})}),e.jsx("input",{ref:m,name:"file",type:"file",onChange:E,hidden:!0}),e.jsx("div",{className:"md:hidden",children:e.jsx(_,{})}),e.jsxs("div",{className:"hidden md:block h-screen min-h-96",children:[e.jsx("div",{className:"border border-neutral-500/20 rounded-t-lg bg-base-100 p-1",children:e.jsx(K,{traces:y,setTraces:c,loading:n,setLoading:o,handleFileUpload:N,appliedProcesses:w,setAppliedProcesses:v,setShowMessage:i})}),e.jsx("div",{className:"border border-neutral-500/20 h-2/3 overflow-y-scroll p-4 relative",children:y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 absolute top-1/2 start-1/2 -translate-x-1/2 -translate-y-1/2",children:[e.jsx("h1",{className:"font-semibold text-3xl",children:"Upload a seismic file"}),e.jsx("p",{className:"text-lg",children:"Start by uploading a seismic file to interact with the tool"}),e.jsxs(b,{onClick:N,loading:n,tooltiptext:"Upload a seismic file",children:[e.jsx(T,{}),"Upload file"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{appliedProcesses:w,handleRemoveProcesses:I}),e.jsx(Q,{traces:y,fourierData:f})]})})]})]})}export{de as default};
