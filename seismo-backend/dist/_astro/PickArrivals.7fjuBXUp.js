import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as x}from"./index.B2tizaEh.js";import{S as R}from"./Spinner.D8BFhGps.js";import{M as A,B as P,T as L,L as I}from"./Button.BWw4eRmr.js";import{M as O,I as T,a as N}from"./index.BnPQjDp5.js";import{a as D,S as w,f as _,B as U,b as k,c as S}from"./index.n4jsme-c.js";import{S as B}from"./Select.c42PT_5A.js";import{S as G,H as E,d as V,L as $}from"./index.Bz_8PPW3.js";import"./preload-helper.BlTxHScW.js";let b;function K({traces:t,selectedWave:s,setSelectedWave:r,handleDeleteWave:a,formattedArrivals:n,loading:l}){return e.jsxs("div",{className:"flex flex-row items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(I,{htmlFor:"p-wave-radio",children:"P"}),e.jsx(T,{type:"radio",id:"p-wave-radio",name:"ps-wave-radio",value:"P",checked:s==="P",onChange:()=>r("P"),disabled:!!(t.length===0||l||n.P!==null),size:"extra-small"})]}),e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(I,{htmlFor:"s-wave-radio",children:"S"}),e.jsx(T,{type:"radio",id:"s-wave-radio",name:"ps-wave-radio",value:"S",checked:s==="S",onChange:()=>r("S"),disabled:!!(t.length===0||l||n.S!==null),size:"extra-small"})]}),n.P!==null&&e.jsxs(P,{onClick:c=>a("P"),style:"error",size:"extra-small",outline:!0,disabled:l,toolTipText:"Delete the selected P wave arrival",children:["P",e.jsx(w,{IconComponent:N})]}),n.S!==null&&e.jsxs(P,{onClick:c=>a("S"),style:"error",size:"extra-small",outline:!0,disabled:l,toolTipText:"Delete the selected S wave arrival",children:["S",e.jsx(w,{IconComponent:N})]})]})}function H({traces:t,handleFilterChange:s,loading:r}){const[a,n]=x.useState({freqMin:"",freqMax:""});function l(c){c.key==="Enter"&&s(a.freqMin?a.freqMin:null,a.freqMax?a.freqMax:null)}return e.jsxs("div",{className:"flex justify-end items-center align-center gap-2 py-4",children:[e.jsx(L,{toolTipText:`For manual filtering: fill only the left field to apply a highpass filter, fill only the right field to 
      apply a lowpass filter, fill both fields to apply a bandpass filter. Press the Enter key to apply.`,children:e.jsx(w,{IconComponent:U})}),e.jsx(T,{type:"number",id:"freq_min",name:"freq_min",value:a.freqMin,onKeyDown:l,onChange:c=>n({...a,freqMin:c.target.value}),placeholder:"e.g. 0.1",disabled:t.length===0||r,size:"small",className:"w-28"}),e.jsx(T,{type:"number",id:"freq_max",name:"freq_max",value:a.freqMax,onKeyDown:l,onChange:c=>n({...a,freqMax:c.target.value}),placeholder:"e.g. 3",disabled:t.length===0||r,size:"small",className:"w-28"})]})}function Q({traces:t,setTraces:s,handleFilterChange:r,setLoading:a,handleFileUpload:n,arrivals:l,setArrivals:c,selectedWave:m,setSelectedWave:g,backupTraces:i,setShowMessage:f,selectedFilter:p,setSelectedFilter:y,loading:v}){let u={P:null,S:null};l.forEach(o=>u[o.wave]=o.arrival);async function F(){let o=u.P,d=u.S,h=(o?`Parr=${o}&`:"")+(d&&`Sarr=${d}`);const{resData:j,error:q}=await D({url:k["SAVE-ARRIVALS"]+"?"+h,method:"get",responseType:"blob",setShowMessage:f,setLoading:a,successMessage:"Arrivals have been downloaded. Please check your 'Downloads' folder.",errorMessage:"Cannot download the arrivals. Please try again later."});if(q)return;const z=window.URL.createObjectURL(j);V(z,"arrivals.txt")}function C(o){y(o.target.value);const d=o.target.value;if(d==="initial")s(i);else{const h=d.split("-");r(h[0],h[1])}}function M(o){g(o),c(l.filter(d=>d.wave!==o))}return e.jsxs("div",{className:"flex flex-row items-center justify-center border border-neutral-500/20 rounded-t-lg bg-base-100 p-3",children:[e.jsxs("div",{className:"flex-grow-0 flex-shrink-0 border-r border-neutral-500/20",children:[e.jsxs(P,{onClick:n,disabled:v,style:"ghost",size:"extra-small",toolTipText:"Upload a seismic file (one of the supported formats in Python Obspy's read function)",children:[e.jsx(w,{IconComponent:E}),"Upload file"]}),e.jsxs(P,{style:"ghost",size:"extra-small",onClick:F,disabled:t.length===0||v||u.P===null&&u.S===null?!0:"",toolTipText:"Download the selected P & S wave arrivals in a txt file. Select at least one arrival to use this option.",children:[e.jsx(w,{IconComponent:O}),"Download arrivals"]})]}),e.jsxs("div",{className:"flex-grow flex flex-row justify-around items-center gap-4 px-4",children:[e.jsx(K,{traces:t,selectedWave:m,setSelectedWave:g,handleDeleteWave:M,formattedArrivals:u,loading:v}),e.jsx(B,{id:"filters-dropdown",name:"filters-dropdown",value:p,onChange:C,disabled:t.length===0||v,optionsList:_,size:"small",className:"w-28 lg:w-40"})]}),e.jsx(L,{toolTipPosition:"top-left",toolTipText:`Select the P or S wave radio button to mark the corresponding 
          wave arrival, then click on the graphs to insert the respective arrival. 
          Use the filter dropdown on the right to apply a predefined filter range.`,children:e.jsx(w,{IconComponent:U})})]})}function Y({traces:t,arrivals:s,selectedWave:r,setArrivals:a,setSelectedWave:n,backupTraces:l}){let c=s.map(i=>({x:l.length!==0?i.arrival-l[0].stats.duration/45:0,y:.8,xref:"x",yref:"paper",text:i.wave,showarrow:!1,font:{size:S.label.size,color:S.label.color}})),m=s.map(i=>({type:"line",x0:i.arrival,y0:0,x1:i.arrival,y1:1,line:{color:S.line.color,width:S.line.width,dash:S.line.style},xref:"x",yref:"paper"}));function g(i){if(b){clearTimeout(b),b=null;return}b=setTimeout(()=>{const f=i.points[0];for(let p of s)if(p.wave===r&&p.arrival)return;if(f){const p=f.x;n(r==="P"?"S":"P"),a(y=>[...y,{wave:r,arrival:p}])}b=null},140)}return e.jsx(e.Fragment,{children:t.map((i,f)=>e.jsx("div",{children:e.jsx($,{xData:[i.xdata],yData:[i.ydata],height:150,legendTitle:[`Component: ${i.stats.component}`],showGraphTitle:f===0,graphTitle:"",shapes:m,annotations:c,onGraphClick:g})},i.trace_id))})}function J({loading:t,handleFileUpload:s}){return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 absolute top-1/2 start-1/2 -translate-x-1/2 -translate-y-1/2",children:[e.jsx("h1",{className:"font-semibold text-3xl text-center",children:"Upload a seismic file"}),e.jsx("p",{className:"text-base text-center",children:"Start by uploading a seismic file to interact with the tool"}),e.jsxs(P,{onClick:s,loading:t,disabled:t,toolTipText:"Upload a seismic file (one of the supported formats in Python Obspy's read function)",children:[e.jsx(w,{IconComponent:E}),"Upload file"]})]})}function X({loading:t,handleFileUpload:s,traces:r,arrivals:a,selectedWave:n,setSelectedWave:l,setArrivals:c,backupTraces:m}){return e.jsx("div",{className:"border border-neutral-500/20 h-2/3 overflow-y-scroll p-4 relative",children:r.length===0?e.jsx(J,{loading:t,handleFileUpload:s}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute start-1/2 -translate-x-1/2",children:t&&e.jsx(R,{})}),e.jsx(Y,{traces:r,arrivals:a,selectedWave:n,setArrivals:c,setSelectedWave:l,backupTraces:m})]})})}function ie(){const[t,s]=x.useState({message:"",type:""}),[r,a]=x.useState(!1),[n,l]=x.useState([]),[c,m]=x.useState([]),[g,i]=x.useState([]),[f,p]=x.useState("P"),[y,v]=x.useState("initial"),u=x.useRef();async function F(o){o.preventDefault();const d=new FormData;d.append("file",o.target.files[0]);const{resData:h,error:j}=await D({url:k["UPLOAD-SEISMIC-FILE"],method:"post",requestData:d,setShowMessage:s,setLoading:a,successMessage:"Your file has been uploaded!",errorMessage:"Cannot upload the file. Please try again later."});j||(console.log(n),i([]),p("P"),v("initial"),l(h),m(h))}function C(o){o.preventDefault(),u.current.click()}async function M(o=null,d=null){const h={traces:c,options:{freq_min:o,freq_max:d}},{resData:j,error:q}=await D({url:k["FILTER-WAVEFORM"],method:"post",requestData:h,setShowMessage:s,setLoading:a,errorMessage:"Cannot filter the waveforms. Please try again later."});q||l(j)}return e.jsxs(e.Fragment,{children:[t.message&&e.jsx(A,{message:t.message,type:t.type,onClose:()=>s({type:"",message:""})}),e.jsx("input",{ref:u,name:"file",type:"file",onChange:F,hidden:!0}),e.jsx("div",{className:"md:hidden",children:e.jsx(G,{})}),e.jsxs("div",{className:"hidden md:block h-screen min-h-96",children:[e.jsx(Q,{traces:n,setTraces:l,handleFilterChange:M,setLoading:a,handleFileUpload:C,arrivals:g,setArrivals:i,selectedWave:f,setSelectedWave:p,backupTraces:c,setShowMessage:s,selectedFilter:y,setSelectedFilter:v,loading:r}),e.jsx(X,{loading:r,handleFileUpload:C,traces:n,arrivals:g,selectedWave:f,setSelectedWave:p,setArrivals:i,backupTraces:c}),e.jsx(H,{traces:n,handleFilterChange:M,loading:r})]})]})}export{ie as default};
