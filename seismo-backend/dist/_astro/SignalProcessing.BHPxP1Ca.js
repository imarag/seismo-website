import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as h}from"./index.B2tizaEh.js";import{M as _,B as y,L as D,T as z}from"./Button.BWw4eRmr.js";import{S as k,H as M,d as A,g as C,L as $}from"./index.Bz_8PPW3.js";import{I as F,b as q,c as V,a as H}from"./index.BnPQjDp5.js";import{S as W}from"./Spinner.D8BFhGps.js";import{S as T}from"./Select.c42PT_5A.js";import{a as x,S as I,t as G,d as Q,e as Y,g as J,h as K,B,b as g}from"./index.n4jsme-c.js";import{T as X}from"./index.BOP_Xtax.js";import{I as Z,a as ee}from"./index.D--nIKpA.js";import"./preload-helper.BlTxHScW.js";function N({onClick:s,loading:r,disabled:l=!1}){return e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(y,{onClick:s,loading:r,size:"small",style:"primary",disabled:l,children:"apply"})})}function R({label:s,icon:r,children:l}){return e.jsxs("div",{className:"dropdown",children:[e.jsxs("div",{tabIndex:0,role:"button",className:"btn btn-ghost btn-md",children:[r,e.jsx("span",{className:"text-xs",children:s}),e.jsx(V,{})]}),e.jsx("div",{tabIndex:0,className:"dropdown-content card card-compact bg-base-100 border border-neutral-500/20 rounded-lg w-64 p-2 shadow-lg",children:e.jsx("div",{className:"card-body",children:l})})]})}function te({traces:s,setTraces:r,loading:l,setLoading:i,handleFileUpload:f,appliedProcesses:c,setAppliedProcesses:p,setShowMessage:m}){const[n,j]=h.useState({"detrend-type":"simple","taper-type":"parzen","taper-side":"both","taper-length":20,"trim-start":0,"trim-end":0,"freq-min":0,"freq-max":0});let b=s.length!==0?s[0].ydata.length/s[0].stats.sampling_rate:0;async function L(){const t={fetchURL:g["TRIM-WAVEFORM"],text:`trim-${n["trim-start"]}-${n["trim-end"]}`,fetchBody:{traces:s,options:{trim_start:n["trim-start"],trim_end:n["trim-end"]}},processId:C()},{resData:a,error:d}=await x({url:t.fetchURL,method:"post",requestData:t.fetchBody,setShowMessage:m,setLoading:i,errorMessage:"Cannot trim the waveforms. Please try again later."});d||(r(a),p([...c,t]),j({...n,"trim-start":0,"trim-end":0}))}async function S(){const t={fetchURL:g["TAPER-WAVEFORM"],text:`taper-${n["taper-type"]}-${n["taper-side"]}-${n["taper-length"]}`,fetchBody:{traces:s,options:{sampling_rate:s[0].stats.sampling_rate,taper_type:n["taper-type"],taper_side:n["taper-side"],taper_length:n["taper-length"]}},processId:C()},{resData:a,error:d}=await x({url:t.fetchURL,method:"post",requestData:t.fetchBody,setShowMessage:m,setLoading:i,errorMessage:"Cannot taper the waveforms. Please try again later."});d||(r(a),p([...c,t]))}async function v(){const t={fetchURL:g["DETREND-WAVEFORM"],text:`detrend-${n["detrend-type"]}`,fetchBody:{traces:s,options:{detrend_type:n["detrend-type"]}},processId:C()},{resData:a,error:d}=await x({url:t.fetchURL,method:"post",requestData:t.fetchBody,setShowMessage:m,setLoading:i,errorMessage:"Cannot detrend the waveform. Please try again later."});d||(r(a),p([...c,t]))}function u(t,a){return t===null&&a===null?"no-filter":t===null&&a!==null?`lowpass-${a}Hz`:t!==null&&a==null?`highpass-${t}Hz`:`bandpass-${t}-${a}Hz`}async function w(){const t={fetchURL:g["FILTER-WAVEFORM"],text:u(n["freq-min"]?n["freq-min"]:null,n["freq-max"]?n["freq-max"]:null),fetchBody:{traces:s,options:{freq_min:n["freq-min"]?n["freq-min"]:null,freq_max:n["freq-max"]?n["freq-max"]:null}},processId:C()},{resData:a,error:d}=await x({url:t.fetchURL,method:"post",requestData:t.fetchBody,setShowMessage:m,setLoading:i,errorMessage:"Cannot filter the waveforms. Please try again later."});d||(r(a),p([...c,t]))}function o(t,a,d="text"){const U=d==="text"?a:Number(a),E={...n,[t]:U};j(E)}async function P(t,a,d){const{resData:U,error:E}=await x({url:g["DOWNLOAD-FILE"],method:"post",requestData:{data:a,file_type:t},setShowMessage:m,setLoading:i,errorMessage:"Cannot download the data. Please try again later.",responseType:"blob"});if(E)return;const O=window.URL.createObjectURL(U);A(O,d+"."+t)}return e.jsxs("div",{className:"flex flex-row items-center justify-center border border-neutral-500/20 rounded-t-lg bg-base-100 p-3",children:[e.jsxs("div",{className:"grow-0 shrink-0 border-r border-neutral-500/20",children:[e.jsxs(y,{onClick:f,style:"ghost",size:"small",disabled:l,toolTipText:"Upload a seismic file (one of the supported formats in Python Obspy's read function)",children:[e.jsx(I,{IconComponent:M}),"Upload file"]}),e.jsxs(y,{onClick:()=>P("mseed",s,s[0].stats.record_name+"_download"),style:"ghost",size:"small",disabled:s.length===0||l,toolTipText:"Download the processed seismic file into MiniSEED file format",children:[e.jsx(X,{}),"Download To MSEED"]})]}),e.jsxs("div",{className:"grow flex flex-row items-center",children:[e.jsx(R,{icon:e.jsx(Q,{}),label:"Taper",children:e.jsxs("div",{className:"flex flex-col items-stretch gap-2",children:[G.map(t=>e.jsxs("div",{children:[e.jsx(D,{htmlFor:t.id,children:t.label}),t.type==="select"?e.jsx(T,{...t,optionsList:t.optionsList,size:"small",value:n[t.id],onChange:a=>o(t.id,a.target.value),disabled:s.length===0}):e.jsx(F,{...t,size:"small",value:n[t.id],onChange:a=>o(t.id,a.target.value),disabled:s.length===0})]},t.id)),e.jsx(N,{onClick:S,loading:l,disabled:s.length===0})]})}),e.jsx(R,{icon:e.jsx(Z,{}),label:"Trim",children:e.jsxs("div",{className:"flex flex-col items-stretch gap-2",children:[Y.map(t=>e.jsxs("div",{children:[e.jsx(D,{htmlFor:t.id,children:t.label}),t.type==="select"?e.jsx(T,{...t,optionsList:t.optionsList,size:"small",value:n[t.name],onChange:a=>o(t.name,a.target.value),disabled:s.length===0}):e.jsx(F,{...t,size:"small",value:n[t.name],max:b,onChange:a=>o(t.name,a.target.value,"number"),disabled:s.length===0})]},t.id)),e.jsx(N,{onClick:L,loading:l,disabled:s.length===0})]})}),e.jsx(R,{icon:e.jsx(q,{}),label:"Detrend",children:e.jsxs("div",{className:"flex flex-col items-stretch gap-2",children:[J.map(t=>e.jsxs("div",{children:[e.jsx(D,{htmlFor:t.id,children:t.label}),t.type==="select"?e.jsx(T,{...t,optionsList:t.optionsList,size:"small",value:n[t.id],onChange:a=>o(t.id,a.target.value),disabled:s.length===0}):e.jsx(F,{...t,size:"small",value:n[t.id],onChange:a=>o(t.id,a.target.value),disabled:s.length===0})]},t.id)),e.jsx(N,{onClick:v,loading:l,disabled:s.length===0})]})}),e.jsx(R,{icon:e.jsx(ee,{}),label:"Filter",children:e.jsxs("div",{className:"flex flex-col items-stretch gap-2",children:[e.jsx(z,{toolTipText:`Fill only the left field to apply a highpass filter, fill only the right field to 
                  apply a lowpass filter, fill both fields to apply a bandpass filter.`,children:e.jsx(I,{IconComponent:B})}),K.map(t=>e.jsxs("div",{children:[e.jsx(D,{htmlFor:t.id,children:t.label}),t.type==="select"?e.jsx(T,{...t,optionsList:t.optionsList,size:"small",value:n[t.id],onChange:a=>o(t.id,a.target.value),disabled:s.length===0}):e.jsx(F,{...t,size:"small",value:n[t.id],onChange:a=>o(t.id,a.target.value),disabled:s.length===0})]},t.id)),e.jsx(N,{onClick:w,loading:l,disabled:s.length===0})]})}),e.jsx(z,{className:"ms-auto",toolTipText:"Upload a seismic file and apply one of the pre-defined processing options. Feel free to download the processed traces.",toolTipPosition:"top-left",children:e.jsx(I,{IconComponent:B})})]})]})}function se({traces:s}){return e.jsx(e.Fragment,{children:s.map((r,l)=>e.jsx("div",{children:e.jsx($,{xData:s.length!==0?[r.xdata]:[],yData:s.length!==0?[r.ydata]:[],height:150,showLegend:!1,legendTitle:[`Component: ${r.stats.component}`],showGraphTitle:l===0,graphTitle:""})},r.trace_id))})}function ae({appliedProcesses:s,handleRemoveProcesses:r}){return e.jsx("div",{children:s.length!==0&&e.jsx("div",{children:e.jsxs("div",{className:"flex flex-row items-center flex-wrap gap-2 my-6",children:[e.jsx("p",{children:"Filters applied:"}),s.map((l,i)=>e.jsxs("span",{className:"badge badge-sm badge-info",children:[i+1,". ",l.text]},l.processId)),e.jsx("span",{className:"ms-5",children:e.jsxs(y,{style:"error",size:"extra-small",onClick:r,toolTipText:"Remove all applied filters",children:["remove all",e.jsx(H,{})]})})]})})})}function ne({loading:s,handleFileUpload:r}){return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 absolute top-1/2 start-1/2 -translate-x-1/2 -translate-y-1/2",children:[e.jsx("h1",{className:"font-semibold text-3xl text-center",children:"Upload a seismic file"}),e.jsx("p",{className:"text-base text-center",children:"Start by uploading a seismic file to interact with the tool"}),e.jsxs(y,{onClick:r,loading:s,disabled:s,toolTipText:"Upload a seismic file (one of the supported formats in Python Obspy's read function)",children:[e.jsx(I,{IconComponent:M}),"Upload file"]})]})}function re({loading:s,handleFileUpload:r,traces:l,backupTraces:i,appliedProcesses:f,handleRemoveProcesses:c}){return e.jsx("div",{className:"border border-neutral-500/20 h-2/3 overflow-y-scroll p-4 relative",children:l.length===0?e.jsx(ne,{loading:s,handleFileUpload:r}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute start-1/2 -translate-x-1/2",children:s&&e.jsx(W,{})}),e.jsx(ae,{appliedProcesses:f,handleRemoveProcesses:c}),e.jsx(se,{traces:l,backupTraces:i})]})})}function ge(){const[s,r]=h.useState({message:"",type:""}),[l,i]=h.useState(!1),[f,c]=h.useState([]),[p,m]=h.useState([]),n=h.useRef(),[j,b]=h.useState([]);function L(){c(p),b([])}async function S(u){u.preventDefault();const w=new FormData;w.append("file",u.target.files[0]);const{resData:o,error:P}=await x({url:g["UPLOAD-SEISMIC-FILE"],method:"post",requestData:w,setShowMessage:r,setLoading:i,successMessage:"Your file has been uploaded!",errorMessage:"Cannot upload the file. Please try again later."});P||(c(o),m(o),b([]))}function v(u){u.preventDefault(),n.current.click()}return e.jsxs(e.Fragment,{children:[s.message&&e.jsx(_,{message:s.message,type:s.type,onClose:()=>r({type:"",message:""})}),e.jsx("input",{ref:n,name:"file",type:"file",onChange:S,hidden:!0}),e.jsx("div",{className:"md:hidden",children:e.jsx(k,{})}),e.jsxs("div",{className:"hidden md:block h-screen min-h-96",children:[e.jsx(te,{traces:f,setTraces:c,loading:l,setLoading:i,handleFileUpload:v,appliedProcesses:j,setAppliedProcesses:b,setShowMessage:r}),e.jsx(re,{loading:l,handleFileUpload:v,traces:f,backupTraces:p,appliedProcesses:j,handleRemoveProcesses:L})]})]})}export{ge as default};
