import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as x}from"./index.B2tizaEh.js";import{S as E,d as z,H as S,L as P}from"./index.Bz_8PPW3.js";import{M as _,B as m,T as A,L as R,F as O}from"./Button.BWw4eRmr.js";import{S as $}from"./Spinner.D8BFhGps.js";import{G as M,M as q,d as B,a as G,I as H,e as Y}from"./index.BnPQjDp5.js";import{a as v,S as c,B as L,b as D,i as Z,j as Q}from"./index.n4jsme-c.js";import{T as V}from"./index.BOP_Xtax.js";import{F as W}from"./internal.sMewP5Pn.js";import"./preload-helper.BlTxHScW.js";function J(t){return M({attr:{viewBox:"0 0 32 32"},child:[{tag:"path",attr:{d:"M 16 3 C 12 3 8.4 4.7992187 6 7.6992188 L 6 4 L 4 4 L 4 12 L 12 12 L 12 10 L 6.8007812 10 C 8.8007812 7 12.1 5 16 5 C 22.1 5 27 9.9 27 16 C 27 22.1 22.1 27 16 27 C 9.9 27 5 22.1 5 16 L 3 16 C 3 23.2 8.8 29 16 29 C 23.2 29 29 23.2 29 16 C 29 8.8 23.2 3 16 3 z"},child:[]}]})(t)}function K(t){return M({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,82a46,46,0,1,0,46,46A46.06,46.06,0,0,0,128,82Zm0,80a34,34,0,1,1,34-34A34,34,0,0,1,128,162ZM214,130.84c.06-1.89.06-3.79,0-5.68L229.33,106a6,6,0,0,0,1.11-5.29A105.34,105.34,0,0,0,219.76,74.9a6,6,0,0,0-4.53-3l-24.45-2.71q-1.93-2.07-4-4l-2.72-24.46a6,6,0,0,0-3-4.53,105.65,105.65,0,0,0-25.77-10.66A6,6,0,0,0,150,26.68l-19.2,15.37c-1.89-.06-3.79-.06-5.68,0L106,26.67a6,6,0,0,0-5.29-1.11A105.34,105.34,0,0,0,74.9,36.24a6,6,0,0,0-3,4.53L69.23,65.22q-2.07,1.94-4,4L40.76,72a6,6,0,0,0-4.53,3,105.65,105.65,0,0,0-10.66,25.77A6,6,0,0,0,26.68,106l15.37,19.2c-.06,1.89-.06,3.79,0,5.68L26.67,150.05a6,6,0,0,0-1.11,5.29A105.34,105.34,0,0,0,36.24,181.1a6,6,0,0,0,4.53,3l24.45,2.71q1.94,2.07,4,4L72,215.24a6,6,0,0,0,3,4.53,105.65,105.65,0,0,0,25.77,10.66,6,6,0,0,0,5.29-1.11L125.16,214c1.89.06,3.79.06,5.68,0l19.21,15.38a6,6,0,0,0,3.75,1.31,6.2,6.2,0,0,0,1.54-.2,105.34,105.34,0,0,0,25.76-10.68,6,6,0,0,0,3-4.53l2.71-24.45q2.07-1.93,4-4l24.46-2.72a6,6,0,0,0,4.53-3,105.49,105.49,0,0,0,10.66-25.77,6,6,0,0,0-1.11-5.29Zm-3.1,41.63-23.64,2.63a6,6,0,0,0-3.82,2,75.14,75.14,0,0,1-6.31,6.31,6,6,0,0,0-2,3.82l-2.63,23.63A94.28,94.28,0,0,1,155.14,218l-18.57-14.86a6,6,0,0,0-3.75-1.31h-.36a78.07,78.07,0,0,1-8.92,0,6,6,0,0,0-4.11,1.3L100.87,218a94.13,94.13,0,0,1-17.34-7.17L80.9,187.21a6,6,0,0,0-2-3.82,75.14,75.14,0,0,1-6.31-6.31,6,6,0,0,0-3.82-2l-23.63-2.63A94.28,94.28,0,0,1,38,155.14l14.86-18.57a6,6,0,0,0,1.3-4.11,78.07,78.07,0,0,1,0-8.92,6,6,0,0,0-1.3-4.11L38,100.87a94.13,94.13,0,0,1,7.17-17.34L68.79,80.9a6,6,0,0,0,3.82-2,75.14,75.14,0,0,1,6.31-6.31,6,6,0,0,0,2-3.82l2.63-23.63A94.28,94.28,0,0,1,100.86,38l18.57,14.86a6,6,0,0,0,4.11,1.3,78.07,78.07,0,0,1,8.92,0,6,6,0,0,0,4.11-1.3L155.13,38a94.13,94.13,0,0,1,17.34,7.17l2.63,23.64a6,6,0,0,0,2,3.82,75.14,75.14,0,0,1,6.31,6.31,6,6,0,0,0,3.82,2l23.63,2.63A94.28,94.28,0,0,1,218,100.86l-14.86,18.57a6,6,0,0,0-1.3,4.11,78.07,78.07,0,0,1,0,8.92,6,6,0,0,0,1.3,4.11L218,155.13A94.13,94.13,0,0,1,210.85,172.47Z"},child:[]}]})(t)}function X({setShowMessage:t,setActivatedMenuIndex:l,loading:i,traces:n,setTraces:r,setLoading:h,traceId:d}){const[o,u]=x.useState(null),[f,a]=x.useState(n),[p,g]=x.useState(null),b=x.useRef(),C=f.find(s=>s.trace_id===d);async function I(s,T,w){let N=f.map((j,y)=>j.trace_id===s?{...j,stats:{...j.stats,[T]:w}}:j);a(N)}async function U(s){const T=f.find(y=>y.trace_id===s),{resData:w,error:N}=await v({url:D["UPDATE-TRACE"],method:"post",requestData:T,setShowMessage:t,setLoading:h,successMessage:"Your header has been updated!",errorMessage:"Cannot update the header. Please try again later."});if(N)return;const j=n.map(y=>y.trace_id===s?w:y);r(j),a(j)}async function k(s){g(null);const T=new FormData;T.append("file",s.target.files[0]);const{resData:w,error:N}=await v({url:D["UPLOAD-TRACE-DATA-SAMPLES"],method:"post",requestData:T,setShowMessage:t,setLoading:h,successMessage:"Your data samples has been uploaded succesfully!",errorMessage:"Cannot upload the file. Please try again later."});if(N)return;let j=f.map((y,oe)=>y.trace_id===d?{...y,ydata:w}:y);a(j),g("Sample data uploaded succesfully!")}function F(s){s.preventDefault(),b.current.click()}return e.jsxs("div",{className:"pt-8 pb-4 px-4 absolute top-0 end-4 bg-base-200 border border-neutral-500/20 shadow rounded z-50 w-64",children:[e.jsx(m,{style:"ghost",size:"small",onClick:()=>l(null),type:"button",className:"absolute top-1 start-2",children:e.jsx(c,{className:"size-4",IconComponent:G})}),e.jsxs("div",{className:"text-xs space-y-2 py-2",children:[e.jsxs("h3",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:"TRACE HEADER"}),e.jsx(A,{toolTipPosition:"bottom-left",toolTipText:"Use the trace header section to view header details of the selected trace. Click the pencil icon next to any editable field to make changes (fields marked with an asterisk * are read-only). Don’t forget to click the 'Update trace' button to save your changes.",children:e.jsx(c,{className:"size-3",IconComponent:L})})]}),e.jsx("hr",{className:"border-neutral-500/50 w-full"}),e.jsx("div",{className:"max-h-30 bg-base-100 px-2 overflow-y-scroll",children:Q.map(s=>e.jsxs("div",{className:"flex items-center gap-2 my-1",children:[e.jsxs(R,{htmlFor:s.id,className:"font-semibold",children:[s.label,":"]}),o===s.id?e.jsx(H,{...s,value:C.stats[s.id],onChange:T=>I(C.trace_id,s.id,T.target.value),size:"extra-small"}):e.jsx("p",{className:"font-light",children:C.stats[s.id]}),!s.readOnly&&(o===s.id?e.jsx("div",{children:e.jsx(m,{style:"ghost",size:"extra-small",type:"button",className:"ms-auto",onClick:()=>u(null),children:e.jsx(c,{IconComponent:J})})}):e.jsx("div",{className:"ms-auto",children:e.jsx(m,{style:"ghost",size:"extra-small",type:"button",toolTipText:`modify '${s.label}'`,toolTipPosition:"left-center",onClick:()=>u(s.id),children:e.jsx(c,{IconComponent:Y})})}))]},s.id))}),e.jsx("p",{className:"text-xs text-center",children:'Elements with "*" are readonly'})]}),e.jsxs("div",{className:"text-xs space-y-2",children:[e.jsxs("h3",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:"TRACE DATA SAMPLES"}),e.jsx(A,{toolTipPosition:"bottom-left",toolTipText:"Use the 'Upload File' option to upload a .csv or .xlsx file with new sample data and replace the current trace data. Don’t forget to click the 'Update trace' button to save your changes.",children:e.jsx(c,{className:"size-3",IconComponent:L})})]}),e.jsx("hr",{className:"border-neutral-500/50 w-full"}),e.jsx("input",{ref:b,name:"file",type:"file",onChange:k,hidden:!0}),e.jsx("div",{className:"space-y-2 my-2",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:"Update trace data"}),e.jsx(A,{toolTipPosition:"bottom-left",toolTipText:"Upload a .csv or .xlsx file containing trace data samples (float values) in a single column. If the file has multiple columns, only the first one will be used. Any headers or non-numeric text will be treated as NaN and replaced with zeros.",children:e.jsx(c,{className:"size-3",IconComponent:L})})]}),e.jsxs(m,{type:"button",style:"primary",loading:i,outline:!0,size:"extra-small",onClick:F,className:"self-center",children:[e.jsx(c,{IconComponent:W}),"Upload file"]})]})}),p&&e.jsxs("p",{className:"flex justify-center items-center gap-2 bg-base-100 py-2 px-4",children:[p,e.jsx(c,{IconComponent:O,className:"text-primary size-5"})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(m,{type:"button",style:"primary",loading:i,size:"extra-small",className:"w-full block",onClick:()=>U(d),children:"Update trace"})})]})}function ee({traces:t,handleFileUpload:l,loading:i,handleDownloadFile:n}){return e.jsxs("div",{className:"flex flex-row items-center justify-start gap-4 border border-neutral-500/20 rounded-t-lg bg-base-100 p-3",children:[e.jsxs(m,{onClick:l,disabled:i,style:"ghost",size:"extra-small",toolTipText:"Upload a seismic file (one of the supported formats in Python Obspy's read function)",children:[e.jsx(c,{IconComponent:S}),"Upload file"]}),e.jsxs(m,{onClick:()=>n("mseed",t,t[0].stats.record_name+"_download"),style:"ghost",size:"extra-small",loading:i,disabled:t.length===0,toolTipText:"Download the updated traces to MiniSEED file format",children:[e.jsx(q,{}),"Download to MSEED"]}),e.jsx(A,{className:"ms-auto",toolTipPosition:"top-left",toolTipText:"Import a seismic file to explore its contents. You can add a new trace, delete an existing one, edit its header metadata, or update its data samples. Feel free to download the trace's header information or its data samples as needed.",children:e.jsx(c,{IconComponent:L})})]})}function te({trace:t,handleOptionsMenuButtonClick:l,handleDeleteTrace:i,handleDownloadFile:n,currentMenuIndex:r}){return e.jsxs("div",{className:"flex flex-row justify-end items-center gap-2",children:[e.jsx(m,{style:"ghost",size:"small",onClick:()=>l(r),toolTipText:"Open the trace menu. Feel free to update the trace header and/or its data samples.",toolTipPosition:"bottom-left",children:e.jsx(c,{IconComponent:K})}),e.jsx(m,{style:"ghost",size:"small",onClick:()=>n("json",t.stats,t.stats.record_name+"_header"),toolTipText:"Download the header information of the current trace in a json format",toolTipPosition:"bottom-left",children:e.jsx(c,{IconComponent:V})}),e.jsx(m,{style:"ghost",size:"small",onClick:()=>n("json",{record_name:t.stats.record_name,component:t.stats.component,data:t.ydata},t.stats.record_name+"_data"),toolTipText:"Download the data samples (values) of the current trace in a json file format",toolTipPosition:"bottom-left",children:e.jsx(c,{IconComponent:Z})}),e.jsx(m,{style:"ghost",size:"small",onClick:()=>i(t.trace_id),toolTipText:"Remove the current trace",toolTipPosition:"bottom-left",className:"text-error",children:e.jsx(c,{IconComponent:B})})]})}function ae({setShowMessage:t,setLoading:l,loading:i,traces:n,setTraces:r,handleDownloadFile:h}){const[d,o]=x.useState(null);function u(a){o(d===a?null:a)}function f(a){const p=n.filter(g=>g.trace_id!==a);r(p)}return e.jsx("div",{className:"flex-grow overflow-scroll",children:n.map((a,p)=>e.jsxs("div",{className:"relative",children:[e.jsx(te,{trace:a,handleOptionsMenuButtonClick:u,handleDeleteTrace:f,handleDownloadFile:h,currentMenuIndex:p}),d===p&&e.jsx(X,{setShowMessage:t,setActivatedMenuIndex:o,loading:i,traces:n,setTraces:r,setLoading:l,traceId:a.trace_id}),e.jsx(P,{xData:[a.xdata],yData:[a.ydata],height:150,legendTitle:[`Component: ${a.stats.component}`],showGraphTitle:p===0,zoomOnScroll:!1,graphTitle:""})]},a.trace_id))})}function se({loading:t,handleFileUpload:l}){return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 absolute top-1/2 start-1/2 -translate-x-1/2 -translate-y-1/2",children:[e.jsx("h1",{className:"font-semibold text-3xl text-center",children:"Upload a seismic file"}),e.jsx("p",{className:"text-base text-center",children:"Start by uploading a seismic file to interact with the tool"}),e.jsxs(m,{onClick:l,loading:t,disabled:t,toolTipText:"Upload a seismic file (one of the supported formats in Python Obspy's read function)",children:[e.jsx(c,{IconComponent:S}),"Upload file"]})]})}function le({traces:t,setTraces:l,setShowMessage:i,setLoading:n}){const[r,h]=x.useState(!1);async function d(){const{resData:o,error:u}=await v({url:D["GET-DEFAULT-TRACE"],method:"get",setShowMessage:i,setLoading:n,successMessage:"A default trace has been added. Feel free to update its contents.",errorMessage:"Cannot add the trace. Please try again later."});u||l([o,...t])}return e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{style:"primary",size:"extra-small",onClick:d,children:"Add trace +"}),e.jsxs(m,{style:"primary",outline:!0,size:"extra-small",onClick:()=>h(o=>!o),children:[r?"Hide":"View"," traces info"]})]}),r&&e.jsxs("div",{className:"text-sm text-base-content/50 space-y-2 my-2 flex-grow-0 flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold",children:"Stream summary:"}),e.jsx("ul",{children:e.jsxs("li",{children:["Total traces: ",t.length]})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold",children:"Traces:"}),e.jsx("ul",{className:"overflow-auto w-full whitespace-nowrap",children:t.map((o,u)=>e.jsx("li",{className:"px-2",children:[`${u+1}. `,`component: ${o.stats.component}`,`station: ${o.stats.station}`,`start date: ${o.stats.start_date}`,`npts: ${o.stats.npts}`,`sampling rate: ${o.stats.sampling_rate}`].join(" | ")},u))})]})]})]})}function ne({loading:t,setLoading:l,setShowMessage:i,handleFileUpload:n,traces:r,handleDownloadFile:h,setTraces:d}){return e.jsx("div",{className:"border border-neutral-500/20 h-2/3 p-4 flex flex-col relative",children:r.length===0?e.jsx(se,{loading:t,handleFileUpload:n}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute start-1/2 -translate-x-1/2",children:t&&e.jsx($,{})}),e.jsx(le,{traces:r,setTraces:d,setShowMessage:i,setLoading:l}),e.jsx(ae,{setShowMessage:i,setLoading:l,loading:t,traces:r,setTraces:d,handleDownloadFile:h})]})})}function je(){const[t,l]=x.useState({message:"",type:""}),[i,n]=x.useState(!1),[r,h]=x.useState([]),d=x.useRef();async function o(a){a.preventDefault();const p=new FormData;p.append("file",a.target.files[0]);const{resData:g,error:b}=await v({url:D["UPLOAD-SEISMIC-FILE"],method:"post",requestData:p,setShowMessage:l,setLoading:n,successMessage:"Your file has been uploaded!",errorMessage:"Cannot upload the file. Please try again later."});b||h(g)}function u(a){a.preventDefault(),d.current.click()}async function f(a,p,g){const{resData:b,error:C}=await v({url:D["DOWNLOAD-FILE"],method:"post",requestData:{data:p,file_type:a},setShowMessage:l,setLoading:n,errorMessage:"Cannot download the file. Please try again later.",responseType:"blob"});if(C)return;const I=window.URL.createObjectURL(b);z(I,g+"."+a)}return e.jsxs("div",{className:"space-y-8",children:[t.message&&e.jsx(_,{message:t.message,type:t.type,onClose:()=>l({type:"",message:""})}),e.jsx("input",{ref:d,name:"file",type:"file",onChange:o,hidden:!0}),e.jsx("div",{className:"md:hidden",children:e.jsx(E,{})}),e.jsxs("div",{className:"hidden md:block h-screen min-h-96",children:[e.jsx(ee,{traces:r,handleFileUpload:u,loading:i,handleDownloadFile:f}),e.jsx(ne,{loading:i,setLoading:n,setShowMessage:l,handleFileUpload:u,traces:r,handleDownloadFile:f,setTraces:h})]})]})}export{je as default};
