import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as f}from"./index.B2tizaEh.js";import{S as I}from"./Spinner.D8BFhGps.js";import{M as A,B as y,L as U}from"./Button.m1076Rmu.js";import{M as T,I as M,a as E}from"./index.DK8rA4Xx.js";import{S as _}from"./Select.YcgN73Xe.js";import{S as z,H as L,L as O,d as B}from"./index.CKKKb5Xc.js";import{a as F,b as P,f as k,c as G}from"./apiRequest.BFgfOc0k.js";import"./internal.BEJtFsX8.js";function V({traces:t,selectedWave:a,setSelectedWave:r,handleDeleteWave:n,formattedArrivals:s}){return e.jsxs("div",{className:"flex flex-row items-center gap-4",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(U,{htmlFor:"p-wave-radio",className:"text-lg mx-2",children:"P"}),e.jsx(M,{type:"radio",id:"p-wave-radio",name:"ps-wave-radio",value:"P",checked:a==="P",onChange:()=>r("P"),disabled:t.length===0||s.P!==null,className:"radio-sm"})]}),e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(U,{htmlFor:"s-wave-radio",className:"text-lg mx-2",children:"S"}),e.jsx(M,{type:"radio",id:"s-wave-radio",name:"ps-wave-radio",value:"S",checked:a==="S",onChange:()=>r("S"),disabled:t.length===0||s.S!==null,className:"radio-sm"})]}),s.P!==null&&e.jsxs(y,{onClick:d=>n("P"),style:"error",size:"extra-small",outline:!0,tooltiptext:"Delete the selected P wave arrival",children:["P",e.jsx(E,{})]}),s.S!==null&&e.jsxs(y,{onClick:d=>n("S"),style:"error",size:"extra-small",outline:!0,tooltiptext:"Delete the selected S wave arrival",children:["S",e.jsx(E,{})]})]})}function $({traces:t,selectedFilter:a,handleDropdownFilterChange:r}){return e.jsx(_,{id:"filters-dropdown",name:"filters-dropdown",value:a,onChange:r,disabled:t.length===0,optionslist:G,className:"select-sm"})}function H({traces:t,manualFilter:a,setManualFilter:r,handleEnterKey:n}){return e.jsxs("div",{className:"flex justify-end align-center gap-3 mt-4",children:[e.jsx(M,{type:"number",id:"freq_min",name:"freq_min",value:a.freqMin,onKeyDown:n,onChange:s=>r({...a,freqMin:s.target.value}),placeholder:"e.g. 0.1",disabled:t.length===0,className:"input-sm w-40"}),e.jsx(M,{type:"number",id:"freq_max",name:"freq_max",value:a.freqMax,onKeyDown:n,onChange:s=>r({...a,freqMax:s.target.value}),placeholder:"e.g. 3",disabled:t.length===0,className:"input-sm w-40"})]})}function K({traces:t,setTraces:a,handleFilterChange:r,setLoading:n,handleFileUpload:s,arrivals:d,setArrivals:p,selectedWave:w,setSelectedWave:h,backupTraces:l,setShowMessage:x,selectedFilter:u,setSelectedFilter:g}){let o={P:null,S:null};d.forEach(i=>o[i.wave]=i.arrival),t.length!==0&&t[0].ydata.length/t[0].stats.sampling_rate;async function N(){let i=o.P,c=o.S,j=(i?`Parr=${i}&`:"")+(c&&`Sarr=${c}`);const{resData:q,error:m}=await F({url:k["SAVE-ARRIVALS"]+"?"+j,method:"get",responseType:"blob",setShowMessage:x,setLoading:n,errorMessage:"Cannot download the arrivals. Please try again later."});if(m)return;const v=window.URL.createObjectURL(q);B(v,"arrivals.txt")}function D(i){g(i.target.value);const c=i.target.value;if(c==="initial")a(l);else{const j=c.split("-");r(j[0],j[1])}}function S(i){h(i),p(d.filter(c=>c.wave!==i))}return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-row items-center justify-center",children:[e.jsxs("div",{className:"grow-0 border-r border-neutral-500/20",children:[e.jsxs(y,{onClick:s,style:"ghost",size:"small",tooltiptext:"Upload a seismic file",children:[e.jsx(L,{}),"Upload file"]}),e.jsxs(y,{style:"ghost",size:"small",onClick:N,disabled:t.length===0||o.P===null&&o.S===null,tooltiptext:"Download the selected P & S wave arrivals in a txt file",children:[e.jsx(T,{}),"Download arrivals"]})]}),e.jsxs("div",{className:"grow flex flex-row justify-around items-center gap-4",children:[e.jsx(V,{traces:t,selectedWave:w,setSelectedWave:h,handleDeleteWave:S,formattedArrivals:o}),e.jsx($,{traces:t,selectedFilter:u,handleDropdownFilterChange:D})]})]})})}function Y({traces:t,arrivals:a,selectedWave:r,setArrivals:n,setSelectedWave:s,backupTraces:d}){let p=a.map(l=>({x:d.length!==0?l.arrival-d[0].stats.duration/40:0,y:.8,xref:"x",yref:"paper",text:l.wave,showarrow:!1,font:{size:P.label.size}})),w=a.map(l=>({type:"line",x0:l.arrival,y0:0,x1:l.arrival,y1:1,line:{color:P.line.color,width:P.line.width,dash:P.line.style},xref:"x",yref:"paper"}));function h(l){const x=l.points[0];for(let u of a)if(u.wave===r&&u.arrival)return;if(x){const u=x.x;s(r==="P"?"S":"P"),n(g=>[...g,{wave:r,arrival:u}])}}return e.jsx(e.Fragment,{children:t.map((l,x)=>e.jsx("div",{className:"h-1/3",children:e.jsx(O,{xData:[l.xdata],yData:[l.ydata],height:"220px",legendTitle:[`Component: ${l.stats.component}`],showGraphTitle:x===0,graphTitle:"",shapes:w,annotations:p,onGraphClick:h})},l.trace_id))})}function le(){const[t,a]=f.useState({message:"",type:""}),[r,n]=f.useState(!1),[s,d]=f.useState([]),[p,w]=f.useState([]),[h,l]=f.useState([]),x=f.useRef(),[u,g]=f.useState("P"),[o,N]=f.useState({freqMin:1,freqMax:3}),[D,S]=f.useState("initial");async function i(m){m.preventDefault();const v=new FormData;v.append("file",m.target.files[0]);const{resData:b,error:C}=await F({url:k["UPLOAD-SEISMIC-FILE"],method:"post",requestData:v,setShowMessage:a,setLoading:n,successMessage:"Your file has been uploaded!",errorMessage:"Cannot upload the file. Please try again later."});C||(l([]),g("P"),S("initial"),d(b),w(b))}function c(m){m.preventDefault(),x.current.click()}async function j(m=null,v=null){const b={traces:p,options:{freq_min:m,freq_max:v}},{resData:C,error:R}=await F({url:k["FILTER-WAVEFORM"],method:"post",requestData:b,setShowMessage:a,setLoading:n,errorMessage:"Cannot filter the waveforms. Please try again later."});R||d(C)}function q(m){m.key==="Enter"&&j(o.freqMin?o.freqMin:null,o.freqMax?o.freqMax:null)}return e.jsxs(e.Fragment,{children:[t.message&&e.jsx(A,{message:t.message,type:t.type,autoDismiss:5e3,position:"bottom-right",onClose:()=>a({type:"",message:""})}),e.jsx("input",{ref:x,name:"file",type:"file",onChange:i,hidden:!0}),e.jsx("div",{className:"md:hidden",children:e.jsx(z,{})}),e.jsxs("div",{className:"hidden md:block h-screen min-h-96",children:[e.jsx("div",{className:"border border-neutral-500/20 rounded-t-lg bg-base-100 p-3",children:e.jsx(K,{traces:s,setTraces:d,handleFilterChange:j,setLoading:n,handleFileUpload:c,arrivals:h,setArrivals:l,selectedWave:u,setSelectedWave:g,backupTraces:p,setShowMessage:a,selectedFilter:D,setSelectedFilter:S})}),e.jsx("div",{className:"border border-neutral-500/20 h-2/3 overflow-y-scroll p-4 relative",children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute start-1/2 ",children:r&&e.jsx(I,{})}),s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 absolute top-1/2 start-1/2 -translate-x-1/2 -translate-y-1/2",children:[e.jsx("h1",{className:"font-semibold text-3xl text-center",children:"Upload a seismic file"}),e.jsx("p",{className:"text-base text-center",children:"Start by uploading a seismic file to interact with the tool"}),e.jsxs(y,{onClick:c,loading:r,tooltiptext:"Upload a seismic file",children:[e.jsx(L,{}),"Upload file"]})]}):e.jsx(e.Fragment,{children:e.jsx(Y,{traces:s,arrivals:h,selectedWave:u,setArrivals:l,setSelectedWave:g,backupTraces:p})})]})}),s.length!==0&&e.jsx("div",{className:"flex justify-end items-center",children:e.jsx(H,{traces:s,manualFilter:o,setManualFilter:N,handleEnterKey:q})})]})]})}export{le as default};
